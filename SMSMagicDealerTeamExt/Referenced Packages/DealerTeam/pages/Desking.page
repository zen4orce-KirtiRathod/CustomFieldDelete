<apex:page id="Desking" standardController="dealer__Deal__c" standardStylesheets="false" extensions="dealer.Desking_EXT" docType="html-5.0" title="{!dealer__Deal__c.Name}" sidebar="false" showChat="true">
    <head>
        <apex:stylesheet value="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"/>
        <!-- <apex:includeScript value="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" /> -->
        <!--
        <apex:includeScript value="{!URLFOR($Resource.BootstrapNS, 'jquery-1.9.1.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.jQuery_UI_1820, 'js/jquery-ui-1.8.20.custom.min.js')}" />
        <apex:includeScript value="{!$Resource.jsHashTable}" />
        <apex:includeScript value="{!$Resource.jQueryNumberFormatting}" />
        <apex:includeScript value="{!$Resource.jsEncoder}" />
        <apex:includeScript value="{!$Resource.InterfaceJS}" />
        

       <apex:includeScript value="{!URLFOR($Resource.SDLResources,'/js/bootstrap.min.js')}"/>
       <apex:stylesheet value="{!URLFOR($Resource.SDLResources,'/css/VFbootstrap.css')}"/>
         -->
        <link rel="stylesheet" href="{!URLFOR($Resource.BootstrapNS, 'bootstrap/css/bootstrap.css')}" media="all" />
        <apex:includeScript value="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" /> 
        <!-- <apex:includeScript value="{!URLFOR($Resource.BootstrapNS, 'jquery-1.9.1.min.js')}" /> --> 
        <apex:includeScript value="{!URLFOR($Resource.dealer__BootstrapNS, 'bootstrap/js/bootstrap.min.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.dealer__BootstrapNS, 'bootstrap/js/bootstrap-typeahead.js')}" />
        <apex:includeScript value="{!$Resource.dealer__jQueryBase64}" />

        <!-- Impact Printing -->
        <apex:includeScript value="{!URLFOR($Resource.dealer__qzPrint, 'js/deployJava.js')}" />
        <apex:includeScript value="{!URLFOR($Resource.dealer__qzPrint, 'js/qzPrintFunctions.js')}" />   
        
<!--        <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css"/> -->
<!--        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script> -->
<!--        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-switch/1.7/bootstrap-switch.min.js"></script> -->
        
<style>
.cmn-toggle {
  margin-left: -9999px;
  position: absolute;
  visibility: hidden;
}
input.cmn-toggle-round:checked + label::before {
  //background-color: #00d700;
  background-color: #6df857;
}
input.cmn-toggle-round + label::before {
  //background-color: #ff0000;
  background-color: #f85757;
  border-radius: 60px;
  right: 1px;
  transition: background 0.4s ease 0s;
}
input.cmn-toggle-round + label::before, input.cmn-toggle-round + label::after {
  bottom: 1px;
  content: "";
  display: block;
  left: 1px;
  position: absolute;
  top: 1px;
}
input.cmn-toggle-round:checked + label::after {
  margin-left: 30px;
}
input.cmn-toggle-round + label::after {
  background-color: #fff;
  border-radius: 100%;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
  transition: margin 0.4s ease 0s;
  width: 30px;
}
input.cmn-toggle-round + label::before, input.cmn-toggle-round + label::after {
  bottom: 1px;
  content: "";
  display: block;
  left: 1px;
  position: absolute;
  top: 1px;
}

input.cmn-toggle-round + label {
  background-color: #dddddd;
  border-radius: 30px;
  height: 30px;
  padding: 2px;
  width: 60px;
}
.cmn-toggle + label {
  -moz-user-select: none;
  cursor: pointer;
  display: block;
  outline: medium none;
  position: relative;
}

</style>

        <script type="text/javascript">
            $dt = jQuery.noConflict();
            var tradeDataToInsert = [];
            var tradeIndata;
            var tabPos;
            $(document).ready(function() {
          
                tradeIndata = jQuery.parseJSON('{!JSENCODE(tradeInJSON)}');
                <!--<apex:outputText rendered="{!NOT(ISBLANK(tradeInJSON))}">var tradeJSON = {!tradeInJSON};</apex:outputText>-->
                <apex:outputText rendered="{!NOT(ISBLANK(tradeInJSON))}">tradeIndata</apex:outputText>
                
                $('.enableTooltip').tooltip();
                
                <apex:outputText rendered="{!NOT(ISBLANK(tradeInJSON))}">
                    /*
                    if(tradeJSON.year !== "null") {
                        $dt('#trade1YearInput').val(tradeJSON.year);
                    }
                    if(tradeJSON.make !== "null") {
                        $dt('#trade1MakeInput').val(tradeJSON.make);
                    }
                    if(tradeJSON.model !== "null") {
                        $dt('#trade1ModelInput').val(tradeJSON.model);
                    }
                    if(tradeJSON.mileage !== "null") {
                        $dt('#trade1Mileage').val(tradeJSON.mileage);
                    }
                    if(tradeJSON.vin !== "null") {
                        $dt('#trade1VIN').val(tradeJSON.vin);
                    }
                    */
                    
                    if(tradeIndata.length>0){
                        
                        $dt(el('Desking:frm:trade1Vehicle')).val(tradeIndata[0].dealer__Service_Vehicle__c);
                        $dt(el('Desking:frm:trade1AppraisalVeh')).val(tradeIndata[0].Id);
                        //$dt(el('trade1_ID')).val(tradeIndata[0].dealer__Service_Vehicle__c);
                        //$dt(el('trade1Lost')).prop('checked', tradeIndata[0].sup.dealer__Lost_Trade__c);
                        $dt(el('trade1Allow')).val(tradeIndata[0].dealer__Appraisal__r.dealer__Appraised_Value__c);
                        //$dt(el('trade1Payoff')).val(tradeIndata[0].dealer__Appraisal__r.dealer__Appraised_Value__c);
                        //$dt(el('trade1Payoff')).val(tradeIndata[0].dealer__Buyer_Contact__c);
                        $dt(el('trade1ACV')).val(tradeIndata[0].dealer__Appraisal__r.dealer__Appraised_Value__c);
                        $dt(el('trade1Stock')).val(tradeIndata[0].dealer__Service_Vehicle__r.dealer__Stock_Number__c);
                        $dt(el('trade1VIN')).val(tradeIndata[0].dealer__VIN__c);
                        $dt(el('trade1Mileage')).val(tradeIndata[0].dealer__Service_Vehicle__r.dealer__Last_Odometer__c);
                        $dt(el('trade1SVYear')).text(tradeIndata[0].dealer__Year__c);
                        $dt(el('trade1SVMake')).text(tradeIndata[0].dealer__Make__c);
                        $dt(el('trade1SVModel')).text(tradeIndata[0].dealer__Model__c);                   
                        $dt(el('trade1YearInput')).val(tradeIndata[0].dealer__Year__c);
                        $dt(el('trade1MakeInput')).val(tradeIndata[0].dealer__Make__c);
                        $dt(el('trade1ModelInput')).val(tradeIndata[0].dealer__Model__c);
                        if(tradeIndata[0].dealer__Sales_Up__r.dealer__Customer_Account__c != null){
                            $dt(el('Desking:frm:trade1PayoffAccount_lkid')).val(tradeIndata[0].dealer__Sales_Up__r.dealer__Customer_Account__c);
                            $dt(el('Desking:frm:trade1PayoffAccount')).val(tradeIndata[0].dealer__Sales_Up__r.dealer__Customer_Account__r.Name);
                        }
                        $dt(el('trade1PayoffExp')).val(tradeIndata[0].dealer__Appraisal__r.dealer__Appraisal_Date__c);
    
                    }
                    
                    if(tradeIndata.length>1){
                        
                        $dt(el('Desking:frm:trade2Vehicle')).val(tradeIndata[1].dealer__Service_Vehicle__c);
                        $dt(el('Desking:frm:trade2AppraisalVeh')).val(tradeIndata[1].Id);
                        //$dt(el('trade2_ID')).val(tradeIndata[1].dealer__Service_Vehicle__c);
                        //$dt(el('trade2Lost')).prop('checked', tradeIndata[1].sup.dealer__Lost_Trade__c);
                        $dt(el('trade2Allow')).val(tradeIndata[1].dealer__Appraisal__r.dealer__Appraised_Value__c);
                        //$dt(el('trade2Payoff')).val(tradeIndata[1].dealer__Service_Vehicle__r.dealer__Stock_Number__c);
                        $dt(el('trade2ACV')).val(tradeIndata[1].dealer__Appraisal__r.dealer__Appraised_Value__c);
                        $dt(el('trade2Stock')).val(tradeIndata[1].dealer__Service_Vehicle__r.dealer__Stock_Number__c);
                        $dt(el('trade2VIN')).val(tradeIndata[1].dealer__VIN__c);
                        $dt(el('trade2Mileage')).val(tradeIndata[1].dealer__Service_Vehicle__r.dealer__Last_Odometer__c);
                        $dt(el('trade2SVYear')).text(tradeIndata[1].dealer__Year__c);
                        $dt(el('trade2SVMake')).text(tradeIndata[1].dealer__Make__c);
                        $dt(el('trade2SVModel')).text(tradeIndata[1].dealer__Model__c);                  
                        $dt(el('trade2YearInput')).val(tradeIndata[1].dealer__Year__c);
                        $dt(el('trade2MakeInput')).val(tradeIndata[1].dealer__Make__c);
                        $dt(el('trade2ModelInput')).val(tradeIndata[1].dealer__Model__c);
                        if(tradeIndata[1].dealer__Sales_Up__r.dealer__Customer_Account__c != null){
                            $dt(el('Desking:frm:trade2PayoffAccount_lkid')).val(tradeIndata[1].dealer__Sales_Up__r.dealer__Customer_Account__c);
                            $dt(el('Desking:frm:trade2PayoffAccount')).val(tradeIndata[1].dealer__Sales_Up__r.dealer__Customer_Account__r.Name);
                        }
                        $dt(el('trade2PayoffExp')).text(tradeIndata[1].dealer__Appraisal__r.dealer__Appraisal_Date__c);
                    }
                    if(tradeIndata.length>2){
                        
                        $dt(el('Desking:frm:trade3Vehicle')).val(tradeIndata[2].dealer__Service_Vehicle__c);
                        $dt(el('Desking:frm:trade3AppraisalVeh')).val(tradeIndata[2].Id);
                        //$dt(el('trade3_ID')).val(tradeIndata[2].dealer__Service_Vehicle__c);
                        //$dt(el('trade3Lost')).prop('checked', tradeIndata[2].sup.dealer__Lost_Trade__c);
                        $dt(el('trade3Allow')).val(tradeIndata[2].dealer__Appraisal__r.dealer__Appraised_Value__c);
                        //$dt(el('trade3Payoff')).val(tradeIndata[2].dealer__Service_Vehicle__r.dealer__Stock_Number__c);
                        $dt(el('trade3ACV')).val(tradeIndata[2].dealer__Appraisal__r.dealer__Appraised_Value__c);
                        $dt(el('trade3Stock')).val(tradeIndata[2].dealer__Service_Vehicle__r.dealer__Stock_Number__c);
                        $dt(el('trade3VIN')).val(tradeIndata[2].dealer__VIN__c);
                        $dt(el('trade3Mileage')).val(tradeIndata[2].dealer__Service_Vehicle__r.dealer__Last_Odometer__c);
                        $dt(el('trade3SVYear')).text(tradeIndata[2].dealer__Year__c);
                        $dt(el('trade3SVMake')).text(tradeIndata[2].dealer__Make__c);
                        $dt(el('trade3SVModel')).text(tradeIndata[2].dealer__Model__c); 
                        $dt(el('trade3YearInput')).val(tradeIndata[2].dealer__Year__c);
                        $dt(el('trade3MakeInput')).val(tradeIndata[2].dealer__Make__c);
                        $dt(el('trade3ModelInput')).val(tradeIndata[2].dealer__Model__c);
                        if(tradeIndata[2].dealer__Sales_Up__r.dealer__Customer_Account__c != null){
                            $dt(el('Desking:frm:trade3PayoffAccount_lkid')).val(tradeIndata[2].dealer__Sales_Up__r.dealer__Customer_Account__c);
                            $dt(el('Desking:frm:trade3PayoffAccount')).val(tradeIndata[2].dealer__Sales_Up__r.dealer__Customer_Account__r.Name);
                        }
                        $dt(el('trade3PayoffExp')).text(tradeIndata[2].dealer__Appraisal__r.dealer__Appraisal_Date__c);
                    }
                    /*
                    if(tradeIndata.length>0){
                        tradeDataToInsert.push(saveTradeData(1));
                    }
                    if(tradeIndata.length>1){
                        tradeDataToInsert.push(saveTradeData(2));
                    }
                    if(tradeIndata.length>2){
                        tradeDataToInsert.push(saveTradeData(3));
                    }*/
                    if(tradeIndata.length==0){
                        $dt(el('Desking:frm:trade1Vehicle')).hide();
                        $dt(el('Desking:frm:trade2Vehicle')).hide();
                        $dt(el('Desking:frm:trade3Vehicle')).hide();
                        
                    }else if(tradeIndata.length==1){
                    
                        $dt(el('Desking:frm:trade2Vehicle')).hide();
                        $dt(el('Desking:frm:trade3Vehicle')).hide();
                    }else if(tradeIndata.length==2){
                    
                        $dt(el('Desking:frm:trade3Vehicle')).hide();
                    }
                </apex:outputText>
                
                // Function to Show Popup 
                $dt('.wrapperClass').change(function(e) {
                    var vehInventory;
                    var dmsStatus = '{!dmsDealStatus}';
                    var currentStatus = document.getElementById('Desking_frm_inlineBlock_inlineBlockSec_inlineBlockSecItem_deal_status').value;
                    /*
                    if(currentStatus == dmsStatus){
                        $("#stockInModal").modal('show');
                    }
                    */
                    if(dmsStatus.includes(currentStatus)){
                        $("#stockInModal").modal('show');
                    }
                });
                
                tabSetting();
            });
            
            // Function to Open Vehicle Record
            function urlOpener(id){
                window.open('/'+id);
            }
            
            // Function to set the current tab
            function tabSetting(){
                $('#deskingTabs li:eq({!$CurrentPage.parameters.tabno}) a').tab('show');
            }
            
            function updateServiceContractSale(el, costType) {
                dealer.Desking_EXT.updateServiceContractSale($dt(el).attr('recordId')+'~'+doubleVal($dt(el).val()),costType, function(result, event) {
                    if(event.status) {
                    //Call actionfunction to execute apex method in order to evaluate backendGross total.
                     evaluateBackEndGrossTotal();
                    } else {
                        alert('Failed to update the Equipment Sale Price');
                    }
                });
            } 
            
            function escRemoveStart() {
                // Display modal showing the removal of a Service Contract
                $('#removeESCModal').modal('show');
            }

            function escRemoveEnd() {
                // Display a modal showing the finalization of the removal of a service contract.
                $('#removeESCModal').modal('hide');
            }
            
        </script>
             
        <script type="text/javascript">
            var JavaInstalled=false;
            var printerName     = '{!JSENCODE(config.dealer__Impact_Printer_Name__c)}';
            var printerEnabled  = '{!config.dealer__Enable_Impact_Forms__c}';
            if(printerEnabled=='true' && printerName != '') {
                deployQZ();
                findPrinter(printerName);
            }

            function deployQZ() {
                var attributes = {id: "qz", code:'qz.PrintApplet.class', 
                    archive:'{!URLFOR($Resource.qzPrint, "qz-print.jar")}', width:0, height:0};
                var parameters = {jnlp_href: '{!URLFOR($Resource.qzPrint, "qz-print_jnlp.jnlp")}', 
                    cache_option:'plugin', disable_logging:'false', 
                    initial_focus:'false'};
                if (deployJava.versionCheck("1.7+") == true) {
                    deployJava.runApplet(attributes, parameters, '1.5');
                    JavaInstalled=true;
                }
                else if (deployJava.versionCheck("1.6+") == true) {
                    attributes['archive'] = '{!URLFOR($Resource.qzPrint, "qz-print.jar")}';
                    parameters['jnlp_href'] = '{!URLFOR($Resource.qzPrint, "jre6/qz-print_jnlp.jnlp")}';
                    deployJava.runApplet(attributes, parameters, '1.5');
                    JavaInstalled=true;
                }         
            }

            function printForm(lineCode) {
                /********** QZ Activated? **********/
                if(!isLoaded()) {
                    return;
                }
                
                setPrinterDefaults();

                /********** CONFIGURATION **********/
                var spaceValue      = '\x20'; // Should be dash or space for debugging, and \x20 for production.
                var lineBreakValue  = '\r\n'; // Should be <br /> for debugging and \r\n for production.
                
                var sourceString = lineCode;
                //sourceString = jQuery.base64.decode(sourceString);
                var lines = sourceString.split("|");
                
                console.log(lines);
                
                var lineCount = 0;
                var buffer = '';
                
                lines.forEach(function(line) {
    
                    var columnCount = 0;
    
                    var columns = line.split("+");
                    
                    columns.forEach(function(column) {
                    
                        if(column) { // <-- This is required to prevent javascript errors.
                            
                            var pieces = column.split("^");
                            
                            var contentLength = pieces[2].length;
                            var spacesToInject = pieces[1] - columnCount;
                            
                            var newColumnLength = contentLength + spacesToInject + columnCount;
                            columnCount = newColumnLength;
                            
                            var toAppend = '';
                            
                            for(var i = 0; i < spacesToInject;  i++) {
                                toAppend+=spaceValue;
                            }
                            
                            toAppend+=pieces[2];
                            
                            buffer+=toAppend;
                            qz.append(toAppend);
                        
                        }
                    }); 
                    
                    buffer+=lineBreakValue;
                    qz.append(lineBreakValue);
                    lineCount+1;  
                       
                });

                console.log(buffer);
                qz.append('\f');
                qz.print();             
            }

        function setPrinterDefaults() {
            qz.append('\x1B\x40'); // Initialize
            // qz.append('\x1B\x47');  // Double Impact
            qz.append("\x1B\x78\x31");  // NLQ
            qz.append("\x1B\x6B\x32"); // Set Font 
            qz.append("\x1B\x67");  // 15 CPI
            qz.append("\x1B\x30"); // 8 lines per inch
            // qz.append("\x1B\x0F"); // Compressed Mode
        }

        function printGridLong() {

            setPrinterDefaults();
            
            for(i=0; i<=110; i++) {
                var myString = i.toString();
                var lastChar = myString.substr(myString.length - 1); 
                qz.append(lastChar);
            }

            qz.append("\r\n");

            for(i=1; i<=200; i++) {
                var lastChar = i.toString();
                if(lastChar.charAt(lastChar.length - 1) == 0) {
                    for(n=0; n<=110; n++) {
                        var myString = n.toString();
                        var lastChar = myString.substr(myString.length - 1); 
                        qz.append(lastChar);
                    }
                    qz.append("\r\n");
                } else {
                    qz.append(i);
                    qz.append("\r\n");
                }
            }

            qz.append("\f");
            qz.print();
        }

        function printGridShort() {

            setPrinterDefaults();
            
            for(i=0; i<=110; i++) {
                var myString = i.toString();
                var lastChar = myString.substr(myString.length - 1); 
                qz.append(lastChar);
            }

            qz.append("\r\n");

            for(i=1; i<=70; i++) {
                var lastChar = i.toString();
                if(lastChar.charAt(lastChar.length - 1) == 0) {
                    for(n=0; n<=110; n++) {
                        var myString = n.toString();
                        var lastChar = myString.substr(myString.length - 1); 
                        qz.append(lastChar);
                    }
                    qz.append("\r\n");
                } else {
                    qz.append(i);
                    qz.append("\r\n");
                }
            }

            qz.append("\f");
            qz.print();
        }
        </script>



        <script type="text/javascript">
        // Globals
        var dealId = '{!JSENCODE(dealer__Deal__c.Id)}';
        var payment = 0;
        var cost = 0;
        var front= 0;
        var warrGross = 0;
        var maintGross = 0;
        var afterMarketGross = 0;
        var financeGross = 0;
        var gapGross = 0;
        var back = 0;
        var down = 0;
        var deferred = 0;
        var warranty_premium = 0;
        var tradenet = 0;
        var tradedata = jQuery.parseJSON('{!JSENCODE(trades)}');
        var aftermarket = 0;
        var aftermarketParts = 0;
        var aftermarketdata = jQuery.parseJSON('{!JSENCODE(aftermarket)}');
        var feedata =   jQuery.parseJSON('{!JSENCODE(feedata)}');
        var previousElement = '';
        var multiQuoteObject = '';
        
        /*
        $dt('#deskingTabs a').click(function (e) {
            e.preventDefault()
            $dt(this).tab('show')
        });
*/
        // DOM ESC
        function el(s) {
            return '#' + s.replace(/(:|\.)/g,'\\\\$1');
        }
        
        // Payment Calculation
        function calcLoan() {

            //Defaults
            calcDeferred();
            totalDown();
            calcTrades();
            calcFees();
            calcTaxes();

            Price                  =    doubleVal($dt(el('Desking:frm:price')).val())
                                            +   doubleVal($dt(el('Desking:frm:warrantyPremium')).val())
                                            +   doubleVal($dt(el('Desking:frm:maintenancePremium')).val())                                            
                                            +   doubleVal($dt(el('gapPremium')).val())
                                            +   doubleVal($dt(el('aftermarkettotal')).val())
                                            +   doubleVal($dt(el('Desking:frm:fees')).val())
                                            +   doubleVal($dt(el('Desking:frm:totaltax')).val());
            DownPayment            =    doubleVal($dt(el('Desking:frm:down')).val()) 
                                            +   doubleVal($dt(el('deferred')).val()) 
                                            +   doubleVal($dt(el('Desking:frm:rebate')).val());
            AnnualInterestRate     =    doubleVal($dt(el('Desking:frm:rate')).val()) / 100;
            MonthlyInterestRate    =    AnnualInterestRate / 12;
            Term                   =    doubleVal($dt(el('Desking:frm:term')).val());
            Warranty               =    doubleVal($dt(el('Desking:frm:warrantyPremium')).val());
            Principal              =    (Price - DownPayment) + Warranty;
                                        if(tradenet>0) { Principal+=(tradenet * -1); }

            Days                   =    doubleVal($dt(el('Desking:frm:days')).val());
            
            var P = parseFloat(Principal);
            var r = parseFloat(MonthlyInterestRate);
            var N = parseFloat(Term);
            var A = P*(r*Math.pow(1+r,N))/(Math.pow(1+r,N)-1);
            var D = parseFloat(Days);
            var i = AnnualInterestRate / 12;
            
            var an = 0;
            var add= 0;

            if(D > 30) {
                an = (1 - 1 / Math.pow((1 + i), N)) / i;
                an = an.toFixed(9);
                add = an * (1 + i);
                add = add.toFixed(9);
                A = P * (1 + D / 30 * i) / add;
                
            }

            /*
            console.log(Price);
            console.log(DownPayment);
            console.log(P);
            console.log(A);
            console.log(D);
            console.log(i);
            console.log(payment);
            */

            payment = A.toFixed(2);

            $dt("#pymt").text(A.toFixed(2));

            calcGross();

            $dt("#fe").text(front.toFixed(2));
            $dt("#be").text(back.toFixed(2));
            $dt(el('Desking:frm:amountfinanced')).val(Principal.toFixed(2));
        }  

        function calcMQ(Form_term, Form_rate, Form_down) {

            console.log('Form Term '+Form_term);
            console.log('Form Rate '+Form_rate);
            console.log('Form Down '+Form_down);

            calcDeferred();
            totalDown();
            calcTrades();
            calcFees();
            calcTaxes();

            Price                  =    doubleVal($dt(el('Desking:frm:price')).val())
                                            +   doubleVal($dt(el('Desking:frm:warrantyPremium')).val())
                                            +   doubleVal($dt(el('Desking:frm:maintenancePremium')).val())                                            
                                            +   doubleVal($dt(el('gapPremium')).val())
                                            +   doubleVal($dt(el('aftermarkettotal')).val())
                                            +   doubleVal($dt(el('Desking:frm:fees')).val())
                                            +   doubleVal($dt(el('Desking:frm:totaltax')).val());
            DownPayment            =    doubleVal(Form_down)
                                            +   doubleVal($dt(el('deferred')).val()) 
                                            +   doubleVal($dt(el('Desking:frm:rebate')).val());

            console.log('Term ('+Form_term+') ');
            console.log('Rate ('+Form_rate+') ');
            console.log('Down ('+Form_down+') ');

            AnnualInterestRate     =    Form_rate / 100;
            MonthlyInterestRate    =    AnnualInterestRate / 12;
            Term                   =    Form_term;
            Warranty               =    doubleVal($dt(el('Desking:frm:warrantyPremium')).val());
            Principal              =    (Price - DownPayment) + Warranty;
                                        if(tradenet>0) { Principal+=(tradenet * -1); }

            Days                   =    doubleVal($dt(el('Desking:frm:days')).val());
            
            var P = parseFloat(Principal);
            var r = parseFloat(MonthlyInterestRate);
            var N = parseFloat(Term);
            var A = P*(r*Math.pow(1+r,N))/(Math.pow(1+r,N)-1);
            var D = parseFloat(Days);
            var i = AnnualInterestRate / 12;

            console.log('Price '+Price);
            console.log('Down '+DownPayment);
            console.log('Warranty '+Warranty);
            console.log('Principal '+P);
            console.log('Rate '+r);
            console.log('Term '+N);
            console.log('APR '+A);
            console.log('Days '+D);
            console.log('I '+i);
            
            var an = 0;
            var add= 0;

            if(D > 30) {
                an = (1 - 1 / Math.pow((1 + i), N)) / i;
                an = an.toFixed(9);
                add = an * (1 + i);
                add = add.toFixed(9);
                A = P * (1 + D / 30 * i) / add;
                
            }

            /*
            console.log(Price);
            console.log(DownPayment);
            console.log(P);
            console.log(A);
            console.log(D);
            console.log(i);
            console.log(payment);
            */

            payment = A.toFixed(2); 

            return payment;           
        }
        
        function calcMVQ(Form_term, Form_rate, Form_down, Form_price) {

            console.log('Form Term '+Form_term);
            console.log('Form Rate '+Form_rate);
            console.log('Form Down '+Form_down);

            calcDeferred();
            totalDown();
            calcTrades();
            calcFees();
            calcTaxes();

            Price                  =    doubleVal(Form_price)
                                            +   doubleVal($dt(el('Desking:frm:warrantyPremium')).val())
                                            +   doubleVal($dt(el('Desking:frm:maintenancePremium')).val())                                            
                                            +   doubleVal($dt(el('gapPremium')).val())
                                            +   doubleVal($dt(el('aftermarkettotal')).val())
                                            +   doubleVal($dt(el('Desking:frm:fees')).val())
                                            +   doubleVal($dt(el('Desking:frm:totaltax')).val());
            DownPayment            =    doubleVal(Form_down)
                                            +   doubleVal($dt(el('deferred')).val()) 
                                            +   doubleVal($dt(el('Desking:frm:rebate')).val());

            console.log('Term ('+Form_term+') ');
            console.log('Rate ('+Form_rate+') ');
            console.log('Down ('+Form_down+') ');

            AnnualInterestRate     =    Form_rate / 100;
            MonthlyInterestRate    =    AnnualInterestRate / 12;
            Term                   =    Form_term;
            Warranty               =    doubleVal($dt(el('Desking:frm:warrantyPremium')).val());
            Principal              =    (Price - DownPayment) + Warranty;
                                        if(tradenet>0) { Principal+=(tradenet * -1); }

            Days                   =    doubleVal($dt(el('Desking:frm:days')).val());
            
            var P = parseFloat(Principal);
            var r = parseFloat(MonthlyInterestRate);
            var N = parseFloat(Term);
            var A = P*(r*Math.pow(1+r,N))/(Math.pow(1+r,N)-1);
            var D = parseFloat(Days);
            var i = AnnualInterestRate / 12;

            console.log('Price '+Price);
            console.log('Down '+DownPayment);
            console.log('Warranty '+Warranty);
            console.log('Principal '+P);
            console.log('Rate '+r);
            console.log('Term '+N);
            console.log('APR '+A);
            console.log('Days '+D);
            console.log('I '+i);
            
            var an = 0;
            var add= 0;

            if(D > 30) {
                an = (1 - 1 / Math.pow((1 + i), N)) / i;
                an = an.toFixed(9);
                add = an * (1 + i);
                add = add.toFixed(9);
                A = P * (1 + D / 30 * i) / add;
                
            }

            /*
            console.log(Price);
            console.log(DownPayment);
            console.log(P);
            console.log(A);
            console.log(D);
            console.log(i);
            console.log(payment);
            */

            payment = A.toFixed(2); 

            return payment;           
        }

        function mvqCalcOptions(ono) {
            var term = doubleVal($dt(el('mvq_down_'+ono)).val());
            var rate = doubleVal($dt(el('mvq_rate_'+ono)).val());
            var down = doubleVal($dt(el('mvq_term_'+ono)).val());
            var price = doubleVal($dt(el('mvq_saleprice_'+ono)).val());
            var pymt = 0;
            
            pymt_1 = calcMVQ(term, rate, down, doubleVal($dt(el('mvq_saleprice_1')).val()));
            pymt_2 = calcMVQ(term, rate, down, doubleVal($dt(el('mvq_saleprice_2')).val()));
            pymt_3 = calcMVQ(term, rate, down, doubleVal($dt(el('mvq_saleprice_3')).val()));

            $dt(el('mvq_pymt_'+ono+'_1')).val(pymt_1);
            $dt(el('mvq_pymt_'+ono+'_2')).val(pymt_1);
            $dt(el('mvq_pymt_'+ono+'_3')).val(pymt_1);
        }

        // Gross Profit Calculation
        function calcGross() {
        
            warrGross        = doubleVal($dt(el('Desking:frm:hidden-warrantyGross')).val());
            maintGross       = doubleVal($dt(el('Desking:frm:hidden-maintGross')).val());
            afterMarketGross = doubleVal($dt(el('Desking:frm:hidden-afterMarketGross')).val());
            financeGross     = doubleVal($dt(el('Desking:frm:hidden-financeGross')).val());
            gapGross         = doubleVal($dt(el('Desking:frm:hidden-gapGross')).val());
            cost             = doubleVal($dt(el('Desking:frm:hidden-vehicle-cost')).val());
            trade_gross      = doubleVal($dt(el('Desking:frm:tradeInput')).val()) - doubleVal($dt(el('Desking:frm:payoff')).val());
            front            = (doubleVal($dt(el('Desking:frm:price')).val()) + trade_gross) - cost;
            /*back = (
                    doubleVal($dt(el('Desking:frm:warrantyPremium')).val())
                    +doubleVal($dt(el('Desking:frm:maintenancePremium')).val())
                    +doubleVal($dt(el('gapPremium')).val())
                    ); */
            //alert('warrGross::'+warrGross + ' maintGross::'+maintGross + 'afterMarketGross::'+afterMarketGross +
            // 'financeGross::'+financeGross+' gapGross::'+gapGross );
                                       
            back = warrGross + maintGross + afterMarketGross + financeGross + gapGross;
            //alert('Back End Gross is'+back);
        }

        function calcDeferred() {
            deferred = doubleVal($dt(el('Desking:frm:deferred_1')).val()) + doubleVal($dt(el('Desking:frm:deferred_2')).val()) + doubleVal($dt(el('Desking:frm:deferred_3')).val());
            $dt(el('deferred')).val(deferred);
        }

        function calcFees() {
            $dt(el('Desking:frm:fees')).val(
                    doubleVal($dt('#licensefee').val())+
                    doubleVal($dt('#misclicensefee').val())+
                    doubleVal($dt('#cancelfee').val())+
                    doubleVal($dt('#restockfee').val())+
                    doubleVal($dt('#excise').val())+
                    doubleVal($dt('#elecfee').val())+
                    doubleVal($dt('#smogabate').val())+
                    doubleVal($dt('#smogfee').val())+
                    doubleVal($dt('#smogcert').val())
                );
        }

        function calcTaxes() {
            // Calc and Apply
            var taxes = doubleVal($dt(el('Desking:frm:price')).val()) *  (doubleVal($dt(el('Desking:frm:countyrate')).val()) / 100);
            $dt(el('Desking:frm:totaltax')).val(round(taxes, 2)); 
        }

        function calcTrades() {

            $dt('#totalTradeAllow').val(doubleVal($dt('#trade1Allow').val())+doubleVal($dt('#trade2Allow').val())+doubleVal($dt('#trade3Allow').val()));
            $dt('#totalTradePayoff').val(doubleVal($dt('#trade1Payoff').val())+doubleVal($dt('#trade2Payoff').val())+doubleVal($dt('#trade3Payoff').val()));
            $dt('#trade1Net').val(doubleVal($dt('#trade1Allow').val()) - doubleVal($dt('#trade1Payoff').val()));
            $dt('#trade2Net').val(doubleVal($dt('#trade2Allow').val()) - doubleVal($dt('#trade2Payoff').val()));
            $dt('#trade3Net').val(doubleVal($dt('#trade3Allow').val()) - doubleVal($dt('#trade3Payoff').val()));
            $dt('#totalTradeNet').val(doubleVal($dt('#trade1Net').val())+doubleVal($dt('#trade2Net').val())+doubleVal($dt('#trade3Net').val()));
            $dt('#totalTradeACV').val(doubleVal($dt('#trade1ACV').val())+doubleVal($dt('#trade2ACV').val())+doubleVal($dt('#trade3ACV').val()));
            $dt('#trade1OverUnder').val(doubleVal($dt('#trade1ACV').val()) - doubleVal($dt('#trade1Allow').val()));
            $dt('#trade2OverUnder').val(doubleVal($dt('#trade2ACV').val()) - doubleVal($dt('#trade2Allow').val()));
            $dt('#trade3OverUnder').val(doubleVal($dt('#trade3ACV').val()) - doubleVal($dt('#trade3Allow').val()));
            $dt('#totalTradeOverUnder').val(doubleVal($dt('#trade1OverUnder').val())+doubleVal($dt('#trade2OverUnder').val())+doubleVal($dt('#trade3OverUnder').val()));

            // Front Screens
            /*
            if($dt(el('Desking:frm:tradeInput')).val()!='') {
               $dt('#trade1Allow').val($dt(el('Desking:frm:tradeInput')).val()); 
            }

            if($dt(el('Desking:frm:payoff')).val()!='') {
               $dt('#trade1Payoff').val($dt(el('Desking:frm:payoff')).val()); 
            } 
            */           
            $dt(el('Desking:frm:tradeInput')).val(tradeLost('trade1Allow',1)+tradeLost('trade2Allow',2)+tradeLost('trade3Allow',3));
            $dt(el('Desking:frm:payoff')).val(tradeLost('trade1Payoff',1)+tradeLost('trade2Payoff',2)+tradeLost('trade3Payoff',3));
            tradenet = $dt('#totalTradeNet').val();
            totalDown();
        }

        function tradeLost(tradeElement, sequence) {
            if($dt(el('trade'+sequence+'Lost')).is( ':checked')) {
               return doubleVal(0); 
            } 
            return doubleVal($dt(el(tradeElement)).val());
        }

        function totalDown() {
            down = ( doubleVal($dt(el('Desking:frm:tradeInput')).val()) +  doubleVal($dt(el('Desking:frm:down')).val()) + doubleVal($dt(el('Desking:frm:rebate')).val()) + doubleVal($dt(el('deferred')).val()) + doubleVal($dt(el('Desking:frm:deposit')).val()) - doubleVal($dt(el('Desking:frm:payoff')).val()));

            $dt(el('totaldown')).val(down);
        }

        function doubleVal(v) {

            if(v== undefined) {
                return 0;
            }
            if(typeof v=='number') {
                return v;
            }           
            if(v=='') {
                return 0;
            }
            if(v === parseInt(v)) {
                return v;
            }
            return Number(v.replace(/[^0-9-.]/g, ''));
        }

        function round(value, decimals) {
            return Number(Math.round(value+'e'+decimals)+'e-'+decimals);
        }        

        $dt( document ).ready(function() {

            // Load Print Applet
            if(JavaInstalled) {
                $dt(el('printerAppletStatus')).html('Impact Printer Applet Loaded');
            } else {
                
            }

            // Window Navigation Save Warning
            var warnMessage = 'There are unsaved changes, please save your Deal if you would like to.';
            $dt('input:not(:button,:submit),textarea,select').change(function () {
                window.onbeforeunload = function () {
                    if (warnMessage != null) return warnMessage;
                }
            });

            $dt('input:submit').click(function(e) {
                warnMessage = null;
            });            

            // Calc Deal Data
            run();

            // Set User Focus
            $dt(el('Desking:frm:stockno')).focus();          

            // Apply vars
            $dt('#discount').val(doubleVal($dt(el('Desking:frm:list')).val()) - doubleVal($dt(el('Desking:frm:price')).val()));
            $dt(el('gapPremium')).val($dt(el('Desking:frm:gappremium')).val());

            // Prevent Form Save on enter key
            $dt("#desk input").keypress(function(e) {
                var code = e.keycode || e.which;
                if(code == 13) {
                    // Enter Key Pressed.
                    event.preventDefault();
                                
                        // Run Deal Calculation
                        run(); 

                        // Send user to next input
                        var element = $dt(this).attr('ff');
                        if(element === undefined) {
                            return false;
                        } else {

                            previousElement = $dt(this).attr('id');
                            if($dt(el(element)).length > 0) {
                                $dt(el(element)).focus();
                            }
                        }                        
                    return false;
                }
            });

            $dt('#desk input,textarea').keydown(function(e) {
                var code = e.keycode || e.which;
                if(e.shiftKey && code == 9) {
                    if($dt(el(previousElement)).length > 0) {
                        $dt(el(previousElement)).focus();
                    } 
                    return false;
                } else { 
                    if(code == 9) {
                        event.preventDefault();
                        // If ATTR FF is set find focus on ATTR val
                        var element = $dt(this).attr('ff');
                        if(element === undefined) {
                            return false;
                        } else {
                            previousElement = $dt(this).attr('id');
                            if($dt(el(element)).length > 0) {
                                $dt(el(element)).focus();
                                $dt(el(element)).select();
                            }
                        }
                        return false;
                    } 
                }            
            });

            /*
            * on focus select all text on input field
            */
            $dt("input[type='text']").focusin(function() {
               $dt(this).select();
            });
       
            // Disable form elements that are not viable.
            $dt('.form-disabled').each(function() {
                $dt(this).attr('disabled', 'disabled');
            });
            
            // Exec the computation of the deal if as things change            
            $dt("#desk input:text").change(function() { 
                run();
            });
            
            // Alert nested objects to no deal ID and disable functions
            // ** If you want to dissable an element that depends on DealID do it here!
            if(dealId === '') {
                $dt(el('aftermarket')).prepend('<div class="alert alert-warning" role="alert" id="noDealNumberAftermaket"><b>Warning!</b> You must save the deal before adding aftermarket products.</div>');
                $dt(el('addProduct')).attr('disabled', 'disabled');
                $dt(el('addPartsKit')).attr('disabled', 'disabled');
                $dt(el('addSinglePart')).attr('disabled', 'disabled');
                $dt(el('addPartsKitAdvanced')).attr('disabled', 'disabled');
            }

            /*
            // Set Tab Order by Row ** Needs some work
            $dt('div .row').each(function() {
                    // For each row
                    $dt(this).find('#col-sm-4').each(function(i) {
                        // For each cell in that row (using i as a counter)
                        $dt(this).find('input').attr('tabindex', i+1);
                        // Set the tabindex of each input in that cell to the counter
                    });
                    // Counter gets reset for every row
            });
            */

            // Poplate Trade data on DOM complete from JSON provided
            if(tradedata.length>0) {
                $dt(el('trade1_ID')).val(tradedata[0].Id);
                $dt(el('Desking:frm:trade1Vehicle')).val(tradedata[0].dealer__Service_Vehicle__c);
                $dt(el('Desking:frm:trade1StockVehId')).val(tradedata[0].dealer__Inventory_Vehicle__c);
                if(tradedata[0].dealer__Inventory_Vehicle__c != null){
                    $dt(el('trade1StockVal')).text(tradedata[0].dealer__Inventory_Vehicle__r.Name);
                }
                $dt(el('trade1Lost')).prop('checked', tradedata[0].dealer__Lost_Trade__c);
                $dt(el('trade1Allow')).val(tradedata[0].dealer__Trade_Allowance__c);
                $dt(el('trade1Payoff')).val(tradedata[0].dealer__Pay_Off_Amount__c);
                $dt(el('trade1ACV')).val(tradedata[0].dealer__ACV__c);
                $dt(el('trade1Stock')).val(tradedata[0].dealer__Stock_Number__c);
                $dt(el('trade1VIN')).val(tradedata[0].dealer__VIN__c);
                $dt(el('trade1Mileage')).val(tradedata[0].dealer__Odometer_at_Trade_In__c);
                //$dt(el('trade1Year')).text(tradedata[0].dealer__Year__c);
                //$dt(el('trade1Make')).text(tradedata[0].dealer__Make__c);
                //$dt(el('trade1Model')).text(tradedata[0].dealer__Model__c);                  
                $dt(el('trade1YearInput')).val(tradedata[0].dealer__Year__c);
                $dt(el('trade1MakeInput')).val(tradedata[0].dealer__Make__c);
                $dt(el('trade1ModelInput')).val(tradedata[0].dealer__Model__c);
                $dt(el('trade1SVYear')).text(tradedata[0].dealer__Year__c);
                $dt(el('trade1SVMake')).text(tradedata[0].dealer__Make__c);
                $dt(el('trade1SVModel')).text(tradedata[0].dealer__Model__c);
                $dt(el('trade1payOffAccNumInput')).val(tradedata[0].dealer__Pay_Off_Account_Number__c);
                if(tradedata[0].dealer__Pay_Off_Account__c != null){
                    $dt(el('Desking:frm:trade1PayoffAccount')).val(tradedata[0].dealer__Pay_Off_Account__r.Name);
                    $dt(el('Desking:frm:trade1PayoffAccount_lkid')).val(tradedata[0].dealer__Pay_Off_Account__c);
                }
                $dt(el('trade1PayoffExp')).val(tradedata[0].dealer__Pay_Off_Expiration_Date__c);
                

                if(tradedata.length>1) {
                    $dt(el('trade2_ID')).val(tradedata[1].Id);
                    $dt(el('Desking:frm:trade2Vehicle')).val(tradedata[1].dealer__Service_Vehicle__c);
                    $dt(el('Desking:frm:trade2StockVehId')).val(tradedata[1].dealer__Inventory_Vehicle__c);
                    if(tradedata[1].dealer__Inventory_Vehicle__c != null){
                        $dt(el('trade2StockVal')).text(tradedata[1].dealer__Inventory_Vehicle__r.Name);
                    }
                    $dt(el('trade2Lost')).prop('checked', tradedata[1].dealer__Lost_Trade__c);
                    $dt(el('trade2Allow')).val(tradedata[1].dealer__Trade_Allowance__c);
                    $dt(el('trade2Payoff')).val(tradedata[1].dealer__Pay_Off_Amount__c);
                    $dt(el('trade2ACV')).val(tradedata[1].dealer__ACV__c);
                    $dt(el('trade2Stock')).val(tradedata[1].dealer__Stock_Number__c);
                    $dt(el('trade2VIN')).val(tradedata[1].dealer__VIN__c);
                    $dt(el('trade2Mileage')).val(tradedata[1].dealer__Odometer_at_Trade_In__c); 
                    //$dt(el('trade2Year')).text(tradedata[1].dealer__Year__c);
                    //$dt(el('trade2Make')).text(tradedata[1].dealer__Make__c);
                    //$dt(el('trade2Model')).text(tradedata[1].dealer__Model__c);
                    $dt(el('trade2YearInput')).val(tradedata[1].dealer__Year__c);
                    $dt(el('trade2MakeInput')).val(tradedata[1].dealer__Make__c);
                    $dt(el('trade2ModelInput')).val(tradedata[1].dealer__Model__c); 
                    $dt(el('trade2SVYear')).text(tradedata[1].dealer__Year__c);
                    $dt(el('trade2SVMake')).text(tradedata[1].dealer__Make__c);
                    $dt(el('trade2SVModel')).text(tradedata[1].dealer__Model__c);
                    $dt(el('trade2payOffAccNumInput')).val(tradedata[1].dealer__Pay_Off_Account_Number__c);
                    $dt(el('trade2PayoffAccount')).val(tradedata[1].dealer__Pay_Off_Account__c);
                    //$dt(el('trade2PayoffExp')).text(tradedata[1].dealer__Pay_Off_Expiration_Date__c);
                    if(tradedata[1].dealer__Pay_Off_Account__c != null){
                        $dt(el('Desking:frm:trade2PayoffAccount')).val(tradedata[1].dealer__Pay_Off_Account__r.Name);
                        $dt(el('Desking:frm:trade2PayoffAccount_lkid')).val(tradedata[1].dealer__Pay_Off_Account__c);
                    }
                    $dt(el('trade2PayoffExp')).val(tradedata[1].dealer__Pay_Off_Expiration_Date__c);
                }

                if(tradedata.length>2) {
                    $dt(el('trade3_ID')).val(tradedata[2].Id);
                    $dt(el('Desking:frm:trade3Vehicle')).val(tradedata[2].dealer__Service_Vehicle__c);
                    $dt(el('Desking:frm:trade3StockVehId')).val(tradedata[2].dealer__Inventory_Vehicle__c);
                    if(tradedata[2].dealer__Inventory_Vehicle__c != null){
                        $dt(el('trade3StockVal')).text(tradedata[2].dealer__Inventory_Vehicle__r.Name);
                    }
                    $dt(el('trade3Lost')).prop('checked', tradedata[2].dealer__Lost_Trade__c);
                    $dt(el('trade3Allow')).val(tradedata[2].dealer__Trade_Allowance__c);
                    $dt(el('trade3Payoff')).val(tradedata[2].dealer__Pay_Off_Amount__c);
                    $dt(el('trade3ACV')).val(tradedata[2].dealer__ACV__c);
                    $dt(el('trade3Stock')).val(tradedata[2].dealer__Stock_Number__c);
                    $dt(el('trade3VIN')).val(tradedata[2].dealer__VIN__c);
                    $dt(el('trade3Mileage')).val(tradedata[2].dealer__Odometer_at_Trade_In__c); 
                    //$dt(el('trade3Year')).text(tradedata[2].dealer__Year__c);
                    //$dt(el('trade3Make')).text(tradedata[2].dealer__Make__c);
                    //$dt(el('trade3Model')).text(tradedata[2].dealer__Model__c);
                    $dt(el('trade3YearInput')).val(tradedata[2].dealer__Year__c);
                    $dt(el('trade3MakeInput')).val(tradedata[2].dealer__Make__c);
                    $dt(el('trade3ModelInput')).val(tradedata[2].dealer__Model__c);
                    $dt(el('trade3SVYear')).text(tradedata[2].dealer__Year__c);
                    $dt(el('trade3SVMake')).text(tradedata[2].dealer__Make__c);
                    $dt(el('trade3SVModel')).text(tradedata[2].dealer__Model__c);
                    $dt(el('trade3payOffAccNumInput')).val(tradedata[2].dealer__Pay_Off_Account_Number__c);
                    if(tradedata[2].dealer__Pay_Off_Account__c != null){
                        $dt(el('Desking:frm:trade3PayoffAccount')).val(tradedata[2].dealer__Pay_Off_Account__r.Name);
                        $dt(el('Desking:frm:trade3PayoffAccount_lkid')).val(tradedata[2].dealer__Pay_Off_Account__c); 
                    }
                    $dt(el('trade3PayoffExp')).val(tradedata[2].dealer__Pay_Off_Expiration_Date__c);                  
                }
                if(tradedata.length==0){
                        $dt(el('Desking:frm:trade1Vehicle')).hide();
                        $dt(el('Desking:frm:trade2Vehicle')).hide();
                        $dt(el('Desking:frm:trade3Vehicle')).hide();
                    }else if(tradedata.length==1){
                        $dt(el('Desking:frm:trade2Vehicle')).hide();
                        $dt(el('Desking:frm:trade3Vehicle')).hide();
                    }else if(tradedata.length==2){
                        $dt(el('Desking:frm:trade3Vehicle')).hide();
                    }
            }    

            // Populate aftermarket data
            buildAftermarketTable();

            // Populate Fee table
            populateFeeData();
                  

            ////////////////////////////////////////////////////////////////////////
            //  DEAL SCREEN
            ////////////////////////////////////////////////////////////////////////
            /*
            *   Set STATE Input to Max 2 Characters
            */
            $dt(el('Desking:frm:state')).keyup(function () {
                if($dt(this).val().length>2) {
                    $dt(this).val($dt(this).val().substr(0,2));
                }
            });     

            // Bind vehicle cost to global variable
            $dt(el('Desking:frm:hidden-vehicle-cost')).change(function() { 
                cost = $dt(el('Desking:frm:hidden-vehicle-cost')).val();
            });

            // If Sale Price falls below cost alert with red text.
            $dt(el('Desking:frm:price')).keyup(function() {
                $dt(el('Desking:frm:salepriceveh')).val(doubleVal($dt(this).val()));
                if(doubleVal($dt(el('Desking:frm:price')).val())>=cost) {
                    $dt(el('Desking:frm:price')).css('color','#000000');
                } else {
                    $dt(el('Desking:frm:price')).css('color','#DF0101');
                }
            });

            // Tab deffered command
            $dt("#deferrednav").click(function() { $dt("#deskingTabs li:eq(4) a").tab('show'); }); 

            // Set Total Down
            $dt(el('Desking:frm:tradeInput')).change(function() { totalDown(); });
            $dt(el('Desking:frm:payoff')).change(function() { totalDown(); });
            $dt(el('Desking:frm:deposit')).change(function() { totalDown(); });
            $dt(el('Desking:frm:down')).change(function() { totalDown(); });
            $dt(el('Desking:frm:rebate')).change(function() { totalDown(); });
            $dt(el('deferred')).change(function() { totalDown(); });

            // Set price based on increase of discount
            $dt(el('discount')).keyup(function () {
                $dt(el('Desking:frm:price')).val(doubleVal($dt(el('Desking:frm:list')).val()) - doubleVal($dt(this).val()));
            }); 

            // GAP Adjustment
            $dt(el('gapPremium')).change(function() {
                if($dt(this).val()>$dt(el('Desking:frm:gappremium')).val()) {
                    $dt(el('Desking:frm:gappremium')).val($dt(this).val());
                }
            });

            // Alert WIP
            $dt(el('wip')).change(function() {
                if($dt(el('wip')).val()!='') {
                    $dt(el('wip')).css('background-color', '#DE5C5C');  
                }
            });

            // Inline Edit Fields
            $dt(".iEdit").mouseenter(function() {
                $dt(this).css("background", "#cfeef8").css("border-color", "#FF9900").css('cursor', 'url(/img/func_icons/util/pencil12.gif) 5 5, default');
            }).mouseleave(function() {
                 $dt(this).css("background", "").css("border-color", "").css('cursor', '');
            });

            $dt('#MQterm1,#MQrate1').change(function(){
                $dt('#MQpymt_1_1').val(calcMQ($dt('#MQterm1').val(), $dt('#MQrate1').val(), $dt('#MQdown1').val()));
                $dt('#MQpymt_2_1').val(calcMQ($dt('#MQterm1').val(), $dt('#MQrate1').val(), $dt('#MQdown2').val()));
                $dt('#MQpymt_3_1').val(calcMQ($dt('#MQterm1').val(), $dt('#MQrate1').val(), $dt('#MQdown3').val()));
                mqObject();
            });

            $dt('#MQterm2,#MQrate2').change(function(){
                $dt('#MQpymt_1_2').val(calcMQ($dt('#MQterm2').val(), $dt('#MQrate2').val(), $dt('#MQdown1').val()));
                $dt('#MQpymt_2_2').val(calcMQ($dt('#MQterm2').val(), $dt('#MQrate2').val(), $dt('#MQdown2').val()));
                $dt('#MQpymt_3_2').val(calcMQ($dt('#MQterm2').val(), $dt('#MQrate2').val(), $dt('#MQdown3').val()));
                mqObject();
            });     

            $dt('#MQterm3,#MQrate3').change(function(){
                $dt('#MQpymt_1_3').val(calcMQ($dt('#MQterm3').val(), $dt('#MQrate3').val(), $dt('#MQdown1').val()));
                $dt('#MQpymt_2_3').val(calcMQ($dt('#MQterm3').val(), $dt('#MQrate3').val(), $dt('#MQdown2').val()));
                $dt('#MQpymt_3_3').val(calcMQ($dt('#MQterm3').val(), $dt('#MQrate3').val(), $dt('#MQdown3').val()));
                mqObject();
            });  

            $dt('#MQdown1').change(function() {
                $dt('#MQpymt_1_1').val(calcMQ($dt('#MQterm1').val(), $dt('#MQrate2').val(), $dt('#MQdown1').val()));
                $dt('#MQpymt_1_2').val(calcMQ($dt('#MQterm2').val(), $dt('#MQrate2').val(), $dt('#MQdown1').val()));
                $dt('#MQpymt_1_3').val(calcMQ($dt('#MQterm3').val(), $dt('#MQrate3').val(), $dt('#MQdown1').val()));
                mqObject();
            });  

            $dt('#MQdown2').change(function() {
                $dt('#MQpymt_2_1').val(calcMQ($dt('#MQterm1').val(), $dt('#MQrate2').val(), $dt('#MQdown2').val()));
                $dt('#MQpymt_2_2').val(calcMQ($dt('#MQterm2').val(), $dt('#MQrate2').val(), $dt('#MQdown2').val()));
                $dt('#MQpymt_2_3').val(calcMQ($dt('#MQterm3').val(), $dt('#MQrate3').val(), $dt('#MQdown2').val()));
                mqObject();
            });

            $dt('#MQdown3').change(function() {
                $dt('#MQpymt_3_1').val(calcMQ($dt('#MQterm1').val(), $dt('#MQrate1').val(), $dt('#MQdown3').val()));
                $dt('#MQpymt_3_2').val(calcMQ($dt('#MQterm2').val(), $dt('#MQrate2').val(), $dt('#MQdown3').val()));
                $dt('#MQpymt_3_3').val(calcMQ($dt('#MQterm3').val(), $dt('#MQrate3').val(), $dt('#MQdown3').val()));
                mqObject();
            }); 

            function mqObject() {
                multiQuoteObject = new Object();
                multiQuoteObject.Term1 = $dt('#MQterm1').val();
                multiQuoteObject.Term2 = $dt('#MQterm2').val();
                multiQuoteObject.Term3 = $dt('#MQterm3').val();
                multiQuoteObject.Rate1 = $dt('#MQrate1').val();
                multiQuoteObject.Rate2 = $dt('#MQrate2').val();
                multiQuoteObject.Rate3 = $dt('#MQrate3').val();
                multiQuoteObject.Down1 = $dt('#MQdown1').val();
                multiQuoteObject.Down2 = $dt('#MQdown2').val();
                multiQuoteObject.Down3 = $dt('#MQdown3').val();

                multiQuoteObject.Row1_1 = $dt('#MQpymt_1_1').val();
                multiQuoteObject.Row1_2 = $dt('#MQpymt_1_2').val();
                multiQuoteObject.Row1_3 = $dt('#MQpymt_1_3').val();

                multiQuoteObject.Row2_1 = $dt('#MQpymt_2_1').val();
                multiQuoteObject.Row2_2 = $dt('#MQpymt_2_2').val();
                multiQuoteObject.Row2_3 = $dt('#MQpymt_2_3').val();

                multiQuoteObject.Row3_1 = $dt('#MQpymt_3_1').val();
                multiQuoteObject.Row3_2 = $dt('#MQpymt_3_2').val();
                multiQuoteObject.Row3_3 = $dt('#MQpymt_3_3').val();

                $dt(el('Desking:frm:multi-quote-payments')).val(JSON.stringify(multiQuoteObject));
            }             
                        
            ////////////////////////////////////////////////////////////////////////
            //  TRADE SCREEN
            ////////////////////////////////////////////////////////////////////////
            $dt("#tradenav").click(function() { $dt("#deskingTabs li:eq(3) a").tab('show'); }); 
            $dt(el('Desking:frm:tradeInput')).blur(function() { $dt(el('Desking:frm:trade1Allow')).val($dt(this).val()); });

            // Get All Trade Input data and create the relevent records
             $dt("input[id*='trade1']").blur(function() { 
                if(dealId!='') {
                    saveTrade(1);
                }
             });

            $dt("input[id*='trade2']").blur(function() { 
                if(dealId!='') {                
                    saveTrade(2);
                }
             });

            $dt("input[id*='trade3']").blur(function() { 
                if(dealId!='') {                    
                    saveTrade(3);
                }
             });

            ////////////////////////////////////////////////////////////////////////
            //  VEHICLE SCREEN 
            ////////////////////////////////////////////////////////////////////////
            $dt("#vehiclenav").click(function() { 
                if($dt(el('Desking:frm:stockno_lkid')).val()!='' && $dt(el('Desking:frm:stockno_lkid')).val() != '000000000000000') {
                    window.open('{!JSENCODE(baseURL)}/'+$dt(el('Desking:frm:stockno_lkid')).val());
                } else {
                    alert('Vehicle must be present before going to the vehicle record.');
                }
            });

            ////////////////////////////////////////////////////////////////////////
            //  AFTERMARKET SCREEN 
            ////////////////////////////////////////////////////////////////////////
            $dt(el('Desking:frm:partsKitLookup')).blur(function() {
                sellPartsKit();
            });

            $dt(el('Desking:frm:partsKitLookup')).keypress(function(event) {
                 var keycode = (event.keyCode ? event.keyCode : event.which);
                if(keycode == '13'){
                    sellPartsKit(); 
                }
            });

            // Set total on Parts Sales Line
            $dt("input[id*='partsKit']").blur(function() {
                var kitSaleTotal = doubleVal($dt(el('Desking:frm:partsKit-Labor')).val())+doubleVal($dt(el('Desking:frm:partsKit-Parts')).val());
                $dt(el('Desking:frm:partsKit-Total')).val(kitSaleTotal.toFixed(2));
            });

            $dt(el('sellPartsKit')).click(function(){
                // Remote and add the sale item to the aftermarket object
                var am = new Object();
                am.dealId = '{!JSENCODE(dealer__Deal__c.Id)}';
                am.description = $dt(el('Desking:frm:partsKitLookup')).val();
                am.labor = doubleVal($dt(el('Desking:frm:partsKit-Labor')).val());
                am.parts = doubleVal($dt(el('Desking:frm:partsKit-Parts')).val());
                am.kit   = $dt(el('Desking:frm:partsKit-Id')).val();
                am.total = (am.labor + am.parts);

                dealer.Desking_EXT.addAfterMarketItem(JSON.stringify(am), function(result, event) {
                    if(event.status) {
                        $dt(el('soldPartsKits')).append();
                             
                        $dt(el('amTable')).append(
                            '<tr>'+
                                '<td>'+$dt(el('Desking:frm:partsKitLookup')).val()+'</td>'+
                                '<td>'+$dt(el('Desking:frm:partsKit-Labor')).val()+'</td>'+
                                '<td>'+$dt(el('Desking:frm:partsKit-Parts')).val()+'</td>'+
                                '<td>'+$dt(el('Desking:frm:partsKit-Total')).val()+'</td>'+
                                '<td><button type="button" id="deletePartsKit-'+$dt(el('Desking:frm:partsKitLookup')).val()+'" class="btn btn-warning" onClick="removePartsKit(\''+result.Id+'\')">Remove</button></td>'+
                            '</tr>'
                        );  
                        aftermarketParts += doubleVal(am.parts);
                        aftermarketdata.push({Id:result.Id, dealer__Car_Deal__c:'{!JSENCODE(dealer__Deal__c.Id)}', dealer__Description__c:am.description, dealer__Labor_Sale__c:am.labor, dealer__Parts_Kit__c:am.kit, dealer__Parts_Sale__c:am.parts,dealer__Sale_Price__c:am.total});

                        $dt(el('Desking:frm:partsKitLookup')).val('');
                        $dt(el('Desking:frm:partsKit-Labor')).val('');
                        $dt(el('Desking:frm:partsKit-Parts')).val('');
                        $dt(el('Desking:frm:partsKit-Total')).val('');

                        if(recordResults) { recordResults = new Object(); }
                        aftermarket = aftermarket + doubleVal(am.total);
                        totalAftermarket();
                       
                    }
                })

                /*
                $dt(el('Desking:frm:partsKit-Labor')).val(recordResults.dealer__Labor_Sale__c);
                $dt(el('Desking:frm:partsKit-Parts')).val(recordResults.dealer__Kit_List__c);
                $dt(el('Desking:frm:partsKit-Total')).val(recordResults.dealer__Kit_List__c + recordResults.dealer__Labor_Sale__c);
                */
            });

            ////////////////////////////////////////////////////////////////////////
            //  Warranty Screen
            ////////////////////////////////////////////////////////////////////////

            // Calc total of Warranty Premium
            $dt("input[id*='service_contract_template']").blur(function() { 
                warranty_premium = 0;

                // If Sale value is set save contract to the deal
                if($dt(this).val()!=''&& $dt(this).val()!=null) {
                    contract = new Object();
                    contract.templateId =   $dt(this).attr('svcid');
                    contract.price      =   doubleVal($dt(this).val());
                    contract.deal_id    =   dealId;
                    contract.contact    =   $dt(el('Desking:frm:buyerLookup')).val();
                    contract.vehicle    =   $dt(el('Desking:frm:stockno_lkid')).val();
                    contract.startdate  =   $dt(el('start_date:'+contract.templateId)).val();
                    contract.enddate    =   $dt(el('exp_date:'+contract.templateId)).val();
                    //contract.exp_miles  =   doubleVal();
                    console.log(contract);
                    // Check Required Field
                    if(contract.startdate != '' && contract.enddate != '' && contract.deal_id != '' && contract.templateId != '') {
                        console.log('Saving Contract to Deal');
                        dealer.Desking_EXT.saveServiceContract(JSON.stringify(contract), function(result, event) {
                            if(event.status) {

                            }
                        });
                    }
                } 

                $dt("input[id*='service_contract_template']").each(function() { 
                    warranty_premium += doubleVal($dt(this).val());
                    console.log($dt(this).attr('id')+' '+doubleVal($dt(this).val()));
                    $dt(el('Desking:frm:warrantyPremium')).val(warranty_premium);
                });
                run();
            });

            // Set End Date of Contract
            $dt("input[id*='start_date']").blur(function() {
                var elId = $dt(this).attr('id');
                var idparts =   elId.split(':');
                var term = $dt(el('')).val();
                $dt(el('exp_date:'+idparts[1])).val();
            });

            ///////////////////////////////////////
            //  Forms Page
            ///////////////////////////////////////

            $dt(el('Desking:frm:formCodePanel')).change(function() {
                console.log($dt(el('Desking:frm:formCodePanel')).text());
            });

            $dt(el('Desking:frm:printerSelected')).change(function() {
                dealer.Desking_EXT.saveImpactPrinterName($dt(this).val(), function(result, event) {
                    console.log(event);
                });   
                findPrinter($dt(this).val());
            });

            $dt(el('Desking:frm:impactOnOff')).change(function () {
                var truefalse = "false"
                if ($dt(this).attr("checked")) {
                    truefalse = "true";
                }
                // Set value
                dealer.Desking_EXT.saveImpactOnOff(truefalse, function(result, event) {
                    if(event.status) {

                    }
                });
            });

            ///////////////////////////////////////
            // Final run
            ///////////////////////////////////////
            calcTrades();
            $dt(el('Desking:frm:stockno')).focus();   
        });
        
        // Engine
        function run() {
            calcTrades();
            calcLoan();
            calcFees();
            $dt("#discount").val(doubleVal($dt(el("Desking:frm:list")).val()) - doubleVal($dt(el("Desking:frm:price")).val()));
        }

        function compileForm(id) {
            $dt.get( "/apex/dealer__dealformcompiler?fid=" + id +"&did="+dealId, function( data ) {
              // Check impact data for validity
              if(data.charAt(0)!='|') {
                // Error
                alert('Error while compiling form for impact printing');
              } else {
                // Send to the printer
                printForm(data);
                console.log(data);              
              }              
            });
        }
        
        /* Commented By KVP on the basis of jarrett mail
        function printPDF(f, dcid, flatten, name) {
            $dt.get('/apex/dealer__FormFDFData?fid='+f+'&did='+dealId, function(data) {

                // Open Window and Post FDF Data
               $dt('<form method="post" action="https://apsv1.dealerteam.com/docgen/fill/'+encodeURIComponent(dcid)+'" target="_blank"><input type="hidden" name="fdf" value="'+data+'" /><input type="hidden" name="f" value="'+f+'" /><input type="hidden" name="DocumentContentId" value="'+dcid+'" /><input type="hidden" name="Flatten" value="'+flatten+'" /><input type="hidden" name="DocumentName" value="'+name+'" /></form>').submit();
            });
        }        
        */
        
        // Added by KVP on the basis of jarrett mail
        function printPDF(f, dcid, flatten, name) {
            $dt.get('/apex/dealer__FormFDFData?fid='+f+'&did='+dealId, function(data) {
                // Open Window and Post FDF Data
               $dt('<form method="post" action="https://apsv1.dealerteam.com/docgen/fillPDF.php" target="_blank"><input type="hidden" name="fdf" value="'+data+'" /><input type="hidden" name="f" value="'+f+'" /><input type="hidden" name="DocumentContentId" value="'+dcid+'" /><input type="hidden" name="Flatten" value="'+flatten+'" /><input type="hidden" name="DocumentName" value="'+name+'" /></form>').submit();
            });
        } 
        
        // Remote Actions
        function setVehicle() {
            //Desking:frm:stockno_lkid
            if($dt(el('Desking:frm:stockno_lkid')).val()!='') {
                //alert($dt(el('Desking:frm:stockno_lkid')).val()); 
                dealer.Desking_EXT.selectStockNumber($dt(el('Desking:frm:stockno_lkid')).val(), function(result, event) {
                    if(event.status) {
                        // Set Vehicle Fields
                        // $dt(el('')).val(); result. 
                        $dt(el('Desking:frm:price')).val(result[0].dealer__MSRP__c);
                        $dt(el('Desking:frm:list')).val(result[0].dealer__Retail_Price__c);
                        $dt(el('discount')).val(result[0].dealer__MSRP__c - result[0].dealer__Retail_Price__c);
                        $dt(el('Desking:frm:hidden-vehicle-cost')).val(result[0].dealer__Vehicle_Cost__c);
                        cost = result[0].dealer__Vehicle_Cost__c + result[0].dealer__Work_in_Process__c;
                        $dt(el('Desking:frm:vehicletype')).val(result[0].dealer__NUO__c);
                        $dt(el('Desking:frm:stocknoveh')).val(result[0].dealer__Stock_Number__c);
                        $dt(el('Desking:frm:vehiclevin')).val(result[0].dealer__VIN__c);
                        $dt(el('Desking:frm:year')).val(result[0].dealer__Year__c);
                        $dt(el('Desking:frm:make')).val(result[0].dealer__Make__c);
                        $dt(el('Desking:frm:model')).val(result[0].dealer__Model__c);
                        $dt(el('Desking:frm:trim')).val(result[0].dealer__Trim_Level__c);
                        $dt(el('Desking:frm:color')).val(result[0].dealer__Exterior_Color__c);
                        $dt(el('Desking:frm:bodytype')).val(result[0].dealer__Body_Type__c);
                        $dt(el('Desking:frm:license')).val(result[0].dealer__License__c);
                        $dt(el('Desking:frm:licexp')).val(result[0].dealer__License_Exp__c);
                        $dt(el('Desking:frm:titletype')).val(result[0].dealer__Title_Type__c);
                        $dt(el('Desking:frm:fueltype')).val(result[0].dealer__Fuel_Type__c);
                        $dt(el('Desking:frm:newtires')).val(result[0].dealer__New_Tires__c);
                        $dt(el('Desking:frm:listpriceveh')).val(result[0].dealer__MSRP__c);
                        $dt(el('Desking:frm:salepriceveh')).val(result[0].dealer__Retail_Price__c);
                        $dt(el('Desking:frm:invoiceprice')).val(result[0].dealer__Invoice_Price__c);
                        $dt(el('Desking:frm:holdback')).val(result[0].dealer__Holdback__c);
                        $dt(el('Desking:frm:pack')).val(result[0].dealer__Pack__c);
                        $dt(el('Desking:frm:odometer')).val(result[0].dealer__Mileage__c);
                        $dt(el('Desking:frm:memo1')).val(result[0].dealer__Memo_One__c);
                        $dt(el('Desking:frm:memo2')).val(result[0].dealer__Memo_Two__c);
                        $dt(el('Desking:frm:keycode1')).val(result[0].dealer__Ignition_Key_Code__c);
                        $dt(el('Desking:frm:keycode2')).val(result[0].dealer__Keyless_Entry_Code__c);
                        $dt('#vehicleStatusCode').text(result[0].dealer__Status_Code__c);
                        $dt('#vehicleDays').text(result[0].dealer__Days_in_Stock__c);
                        $dt(el('wip')).val(result[0].dealer__Work_in_Process__c); 

                        run();
                    }
                });
                                                  
            }
        }

        function mqv(ename, no) {

            dealer.Desking_EXT.selectStockNumber($dt(el('Desking:frm:'+ename+'_lkid')).val(), function(result, event) {
                if(event.status) {
                    $dt(el('mvq_trim_'+no)).val(result[0].dealer__Trim_Level__c);
                    $dt(el('mvq_color_'+no)).val(result[0].dealer__Exterior_Color__c);
                    $dt(el('mvq_engine_'+no)).val(result[0].dealer__Engine_Description__c);
                    $dt(el('mvq_transmission_'+no)).val(result[0].dealer__Transmission_Type__c);
                    $dt(el('mvq_msrp_'+no)).val(result[0].dealer__MSRP__c);
                    $dt(el('mvq_saleprice_'+no)).val(result[0].dealer__Retail_Price__c);
                    $dt(el('mvq_discount_'+no)).val($dt(el('mvq_msrp_'+no)).val() - $dt(el('mvq_saleprice_'+no)).val());
                }
            });
        }
        
        function setBuyer() {
            if($dt(el('Desking:frm:buyerLookup_lkid')).val()!='') {
                dealer.Desking_EXT.lookupContact($dt(el('Desking:frm:buyerLookup_lkid')).val(), function(result, event) {
                    if(event.status) {
                        // $dt(el('')).val(result.);
                        $dt(el('Desking:frm:buyerfirst')).val(result.FirstName);                           
                        $dt(el('Desking:frm:buyermiddle')).val(result.dealer__MiddleName__c);
                        $dt(el('Desking:frm:buyerlast')).val(result.LastName);
                        $dt(el('Desking:frm:buyeraddress')).val(result.MailingStreet);
                        $dt(el('Desking:frm:buyercity')).val(result.MailingCity);
                        $dt(el('Desking:frm:buyerstate')).val(result.MailingState);
                        $dt(el('Desking:frm:buyerpostalcode')).val(result.MailingPostalCode);
                        $dt(el('Desking:frm:buyerphone')).val(result.Phone);
                        $dt(el('Desking:frm:buyermobile')).val(result.MobilePhone);
                        $dt(el('Desking:frm:buyeremail')).val(result.Email);
                        $dt(el('Desking:frm:buyerdob')).val(result.Birthdate);
                        //$dt(el('Desking:frm:buyerssn')).val(result.);
                        //$dt(el('Desking:frm:buyergender')).val(result.);
                        $dt(el('Desking:frm:buyerlicno')).val(result.dealer__Drivers_License_Number__c);
                        $dt(el('Desking:frm:buyerliceexp')).val(result.dealer__Drivers_License_Expiration_Date__c);
                    } 
                 });
            }
        }
        
        function setCoBuyer() {
            if($dt(el('Desking:frm:cobuyerLookup_lkid')).val()!='') {
                dealer.Desking_EXT.lookupContact($dt(el('Desking:frm:cobuyerLookup_lkid')).val(), function(result, event) {
                    if(event.status) {
                         // $dt(el('')).val(result.);
                        $dt(el('Desking:frm:cobuyerfirst')).val(result.FirstName);
                        $dt(el('Desking:frm:cobuyermiddle')).val(result.dealer__MiddleName__c);
                        $dt(el('Desking:frm:cobuyerlast')).val(result.LastName);
                        $dt(el('Desking:frm:cobuyeraddress')).val(result.MailingStreet);
                        $dt(el('Desking:frm:cobuyercity')).val(result.MailingCity);
                        $dt(el('Desking:frm:cobuyerstate')).val(result.MailingState);
                        $dt(el('Desking:frm:cobuyerpostalcode')).val(result.MailingPostalCode);
                        $dt(el('Desking:frm:cobuyerphone')).val(result.Phone);
                        $dt(el('Desking:frm:cobuyermobile')).val(result.MobilePhone);
                        $dt(el('Desking:frm:cobuyeremail')).val(result.Email);
                        $dt(el('Desking:frm:cobuyerdob')).val(result.Birthdate);
                        $dt(el('Desking:frm:cobuyerlicno')).val(result.dealer__Drivers_License_Number__c);
                        $dt(el('Desking:frm:cobuyerliceexp')).val(result.dealer__Drivers_License_Expiration_Date__c);

                    }
                 });
            }
        }
        
        function setBusiness() {
            if($dt(el('Desking:frm:companylookup_lkid')).val()!='') {
                dealer.Desking_EXT.lookupAccount($dt(el('Desking:frm:companylookup_lkid')).val(), function(result, event) {
                    if(event.status) {
                         // $dt(el('')).val(result.);
                        $dt(el('Desking:frm:contractedname')).val(result.Name);
                        $dt(el('Desking:frm:contractaddress')).val(result.BillingStreet);
                        $dt(el('Desking:frm:contractedcity')).val(result.BillingCity);
                        $dt(el('Desking:frm:contractedstate')).val(result.BillingState);
                        $dt(el('Desking:frm:contractedpostalcode')).val(result.BillingPostalCode);
                        $dt(el('Desking:frm:contractedphone')).val(result.Phone);
                        
                    }
                 });
            }
        }   
        
        function setBroker() {
            if($dt(el('Desking:frm:brokerlookup_lkid')).val()!='') {
                dealer.Desking_EXT.lookupAccount($dt(el('Desking:frm:brokerlookup_lkid')).val(), function(result, event) {
                    if(event.status) {
                         // $dt(el('')).val(result.);
                        $dt(el('Desking:frm:brokername')).val(result.Name);
                        $dt(el('Desking:frm:brokeraddress')).val(result.BillingStreet);
                        $dt(el('Desking:frm:brokercity')).val(result.BillingCity);
                        $dt(el('Desking:frm:brokerstate')).val(result.BillingState);
                        $dt(el('Desking:frm:brokerpostalcode')).val(result.BillingPostalCode);
                        $dt(el('Desking:frm:brokerphone')).val(result.Phone);   
                    }
                 });
            }
        } 
    
        function setTaxRate() {
            if($dt(el('Desking:frm:state')).val()!='' && $dt(el('Desking:frm:county')).val()!='') {
                // Set County val on Fees Page
                $dt(el('deliverto')).val($dt(el('Desking:frm:county')).val());
                $dt(el('delvierto')).attr('disabled', 'disabled');
                var lookupVar = $dt(el('Desking:frm:state')).val()+':'+$dt(el('Desking:frm:county')).val();
                dealer.Desking_EXT.getTaxZone(lookupVar, function(result, event) { 
                    if(event.status) {
                        $dt(el('Desking:frm:countyrate')).val(result.dealer__Rate__c);   
                    }
                });
            }
        }

        function setFinanceCompany() {
            $dt('#deal-lender-val').text($dt(el('Desking:frm:bank')+' option:selected').text());
            $dt(el('Desking:frm:lenderName')).val($dt(el('Desking:frm:bank')+' option:selected').text());
            $dt(el('Desking:frm:lender-name-hidden')).val($dt(el('Desking:frm:bank')+' option:selected').text());
            $dt(el('Desking:frm:lender-hidden')).val($dt(el('Desking:frm:bank')+' option:selected').val());
        }

        function sellPartsKit() {
            // Check for recordResult to be present in the DOM
            if(recordResults) {
                // Assign inputs the values returned
                if(recordResults.dealer__Kit_List__c == undefined) { recordResults.dealer__Kit_List__c = 0; }
                if(recordResults.dealer__Labor_Sale__c == undefined) { recordResults.dealer__Labor_Sale__c = 0; }
                $dt(el('Desking:frm:partsKit-Id')).val(recordResults.Id);
                $dt(el('Desking:frm:partsKit-Labor')).val(recordResults.dealer__Labor_Sale__c);
                $dt(el('Desking:frm:partsKit-Parts')).val(recordResults.dealer__Kit_List__c);
                $dt(el('Desking:frm:partsKit-Total')).val(recordResults.dealer__Kit_List__c + recordResults.dealer__Labor_Sale__c);
            }
        }

        function removePartsKit(kitId) {
            dealer.Desking_EXT.deleteAftermarketItem(kitId, function(result, event) {
                if(event.status) {
                    if(result==true) {
                        // Re-Calculate AM
                        for (var key in aftermarketdata) {
                            if (aftermarketdata.hasOwnProperty(key)) {
                                // console.log(aftermarketdata[key].Id);
                                if(aftermarketdata[key].Id == kitId) {
                                    delete aftermarketdata[key];
                                }
                            }
                        }
                        buildAftermarketTable();
                    }
                }
            });
        }

        function buildAftermarketTable() {
            $dt(el('amTableBody')).html('');
            aftermarket=0;
            aftermarketParts=0;
            for (var key in aftermarketdata) {
               if (aftermarketdata.hasOwnProperty(key)) {
                    $dt(el('amTableBody')).append(
                            '<tr>'+
                                '<td>'+aftermarketdata[key].dealer__Description__c+'</td>'+
                                '<td>'+doubleVal(aftermarketdata[key].dealer__Labor_Sale__c)+'</td>'+
                                '<td>'+doubleVal(aftermarketdata[key].dealer__Parts_Sale__c)+'</td>'+
                                '<td>'+aftermarketdata[key].dealer__Sale_Price__c.toFixed(2)+'</td>'+
                                '<td><button type="button" id="deletePartsKit-'+aftermarketdata[key].dealer__Parts_Kit__c+'" class="btn btn-warning" onClick="removePartsKit(\''+aftermarketdata[key].Id+'\')">Remove</button></td>'+
                            '</tr>');
                    aftermarket = aftermarket + doubleVal(aftermarketdata[key].dealer__Sale_Price__c);
                    aftermarketParts = aftermarketParts + doubleVal(aftermarketdata[key].dealer__Parts_Sale__c);
                                   
               }
            }
            totalAftermarket();
        }

        function totalAftermarket() {
           // var total = doubleVal(aftermarket) + doubleVal($dt(el('trade'+n+'Allow')).val());
            $dt(el('aftermarkettotal')).val(doubleVal(aftermarket)+doubleVal($dt(el('Desking:frm:hidden-afterMarketGross')).val())); 
            run();	

             //added by kvp 30-12 
             //making readonly and show and hide the symbols for aftermarket field on purchase screen.
              if("{!isOtherPrem}" == 'true' || aftermarket > 0){
             		$dt('[id$=aftermarkettotal]').prop("disabled","disabled");
             		 if(!$dt('[id$=afterMarketLabel]').children('i').hasClass('fa fa-calculator fa-lg')){
             		       $dt('[id$=afterMarketLabel]').append('<i class="fa fa-calculator fa-lg" id="faCalIcon"></i>'); 
             		 }
             		$dt('[id$=fapencilIcon]').hide();
             		$dt('[id$=faCalIcon]').show();
              }else{
                  $dt('[id$=aftermarkettotal]').prop("disabled", false);
                  if(!$dt('[id$=afterMarketLabel]').children('i').hasClass('fa fa-pencil fa-lg')){
             		       $dt('[id$=afterMarketLabel]').append('<i class="fa fa-pencil fa-lg" id="fapencilIcon"></i>'); 
             		 }
                   $dt('[id$=faCalIcon]').hide();
                   $dt('[id$=fapencilIcon]').show();
              }
              /************end KVP***********/
        }
        // Function to convert data in JSON object
        function saveTradeData(n) {
            var tradeObject = new Object();
            tradeObject.serviceVehId = $dt(el('Desking:frm:trade'+n+'Vehicle')).val();
            tradeObject.appraisalVehId = $dt(el('Desking:frm:trade'+n+'AppraisalVeh')).val();
            tradeObject.Id          =   $dt(el('trade'+n+'_ID')).val();
            tradeObject.deal        =   dealId;
            tradeObject.number      =   n;
            tradeObject.allowance   =   doubleVal($dt(el('trade'+n+'Allow')).val());
            tradeObject.payoff      =   doubleVal($dt(el('trade'+n+'Payoff')).val());
            tradeObject.acv         =   doubleVal($dt(el('trade'+n+'ACV')).val());
            tradeObject.stock       =   $dt(el('trade'+n+'Stock')). val();
            tradeObject.vin         =   $dt(el('trade'+n+'VIN')).val(); 
            tradeObject.odometer    =   doubleVal($dt(el('trade'+n+'Mileage')).val());
            tradeObject.lost        =   false;
            tradeObject.year        =   $dt(el('trade'+n+'YearInput')).val();
            tradeObject.make        =   $dt(el('trade'+n+'MakeInput')).val();
            tradeObject.model       =   $dt(el('trade'+n+'ModelInput')).val();
            tradeObject.payoffAccount = $dt(el('Desking:frm:trade'+n+'PayoffAccount')).val();
            tradeObject.payoffExp   =   $dt(el('trade'+n+'PayoffExp')).val();

            if($dt(el('trade'+n+'Lost')).is( ":checked" )) { 
                tradeObject.lost    =   true;
            }

            calcTrades();
            run();
            
            return JSON.stringify(tradeObject);
        }
        
        function saveTrade(n) {

            // Display Alert
            $dt(el('saveTrade'+n+'_Alert')).html('<span class="alert alert-success" role="alert">Saving</span>');

            var tradeObject = new Object();
            //tradeObject.serviceVehId = $dt(el('Desking:frm:trade'+n+'Vehicle')).val();
            tradeObject.Id          =   $dt(el('trade'+n+'_ID')).val();
            tradeObject.deal        =   dealId;
            tradeObject.number      =   n;
            tradeObject.allowance   =   doubleVal($dt(el('trade'+n+'Allow')).val());
            tradeObject.payoff      =   doubleVal($dt(el('trade'+n+'Payoff')).val());
            tradeObject.acv         =   doubleVal($dt(el('trade'+n+'ACV')).val());
            tradeObject.stock       =   $dt(el('trade'+n+'Stock')). val();
            tradeObject.vin         =   $dt(el('trade'+n+'VIN')).val(); 
            tradeObject.odometer    =   doubleVal($dt(el('trade'+n+'Mileage')).val());
            tradeObject.lost        =   false;
            tradeObject.year        =   $dt(el('trade'+n+'YearInput')).val();
            tradeObject.make        =   $dt(el('trade'+n+'MakeInput')).val();
            tradeObject.model       =   $dt(el('trade'+n+'ModelInput')).val();
            tradeObject.payoffAccountNum  =   $dt(el('trade'+n+'payOffAccNumInput')).val();
            tradeObject.payoffAccount = $dt(el('Desking:frm:trade'+n+'PayoffAccount_lkid')).val();
            tradeObject.payoffExp   =   $dt(el('trade'+n+'PayoffExp')).val();

            if($dt(el('trade'+n+'Lost')).is( ":checked" )) { 
                tradeObject.lost    =   true;
            }

            calcTrades();
            run();
            //alert(tradeObject);
            //alert(JSON.stringify(tradeObject));
            dealer.Desking_EXT.saveTrades(JSON.stringify(tradeObject), function(result, event) {
                if(event.status) {
                    $dt(el('trade'+n+'_ID')).val(result.Id);
                    $dt(el('trade'+n+'Year')).text(result.dealer__Year__c);
                    $dt(el('trade'+n+'Make')).text(result.dealer__Make__c);
                    $dt(el('trade'+n+'Model')).text(result.dealer__Model__c);
                    $dt(el('saveTrade'+n+'_Alert')).html('');
                }
            });
        }


        function saveFee(field, elementId) {
            // Check for a Deal ID
            if(dealId == '') { return false; }
            if($dt(el(elementId)).val()=='') { return false; }
            // Build the object
            var feeObject = new Object();
            var amount = doubleVal($dt(el(elementId)).val());
            var sfid   = $dt(el(elementId)).attr('sfid');

            feeObject.dealId    = dealId;
            feeObject.feeId     = sfid;
            feeObject.feeAmount = amount;
            feeObject.feeName   = field;

            console.log(feeObject);

            dealer.Desking_EXT.saveFee(JSON.stringify(feeObject), function(result, event){
                if(event.status) {
                    if(result.Id!=null) {
                        $dt(el(elementId)).attr('sfid', result.Id);
                    }
                }
            });
        }


        function populateFeeData() {
            for (var key in feedata) {
               if (feedata.hasOwnProperty(key)) {
                    switch(feedata[key].dealer__Fee_Name__c) {
                        case "License":
                            $dt(el('licensefee')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('licensefee')).attr('sfid', feedata[key].Id);
                            break;
                        case "Misc. License":
                            $dt(el('misclicensefee')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('misclicensefee')).attr('sfid', feedata[key].Id);
                            break;
                        case "Cancellation":
                            $dt(el('cancelfee')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('cancelfee')).attr('sfid', feedata[key].Id);
                            break;
                        case "Restocking":
                            $dt(el('restockfee')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('restockfee')).attr('sfid', feedata[key].Id);
                            break;
                        case "Excise":
                            $dt(el('excise')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('excise')).attr('sfid', feedata[key].Id);
                            break;
                        case "Electronic Filing":
                            $dt(el('elecfee')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('elecfee')).attr('sfid', feedata[key].Id);
                            break;
                        case "Tire Fee":
                            $dt(el('tirefee')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('tirefee')).attr('sfid', feedata[key].Id);
                            break;
                        case "Smog Abatement":
                            $dt(el('smogabate')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('smogabate')).attr('sfid', feedata[key].Id);
                            break;
                        case "Smog Fee":
                            $dt(el('smogfee')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('smogfee')).attr('sfid', feedata[key].Id);
                            break;
                        case "Smog Certificate":
                            $dt(el('smogcert')).val(feedata[key].dealer__Fee_Amount__c);
                            $dt(el('smogcert')).attr('sfid', feedata[key].Id);
                            break;
                    }    
               }
            }
        }

        // Final Window Load settings
        $dt(window).load(function() {
             $dt(el('Desking:frm:stockno')).focus();
             run();
        });
        
        function displayInfo(){
            alert('No changes made on the deal');
            location.reload();
        }
        
        /*
        // Not in use
        function redirect(objId) {
          window.href.location = '/' + objId;
          
        }
        */
        
        // Added By KVP 
        // Function to Redirect to currentTab
        function redirect() {
          var currentTabId = $(".nav li.active").index();
          redirectToActTab(currentTabId);
        }
        
        // Added By KVP 
        // Function to create the deal
        function saveNewDeal(){
            document.getElementById('focusMeOnSave').click();
            if(tradeIndata.length>0){
                tradeDataToInsert.push(saveTradeData(1));
            }
            if(tradeIndata.length>1){
                tradeDataToInsert.push(saveTradeData(2));
            }
            if(tradeIndata.length>2){
                tradeDataToInsert.push(saveTradeData(3));
            }
            
            var currentTabId = $(".nav li.active").index();
            saveDeal(tradeDataToInsert.toString(), currentTabId);
        }
        
        // Added By KVP 
        // Function to update the deal
        function updateDeal(){
            document.getElementById('focusMeOnUpdate').click();
            var currentTabId = $(".nav li.active").index();
            saveDeal('', currentTabId);
        }
        
        function saveInventory(){
            document.getElementById('focusMeOnCreate').click();
            //createInventory();
        }
        
        function calcGrossOnload() {
                   
					warrGross        = doubleVal($dt(el('Desking:frm:hidden-warrantyGross')).val());
					maintGross       = doubleVal($dt(el('Desking:frm:hidden-maintGross')).val());
					afterMarketGross = doubleVal($dt(el('Desking:frm:hidden-afterMarketGross')).val());
					financeGross     = doubleVal($dt(el('Desking:frm:hidden-financeGross')).val());
					gapGross         = doubleVal($dt(el('Desking:frm:hidden-gapGross')).val());
					cost             = doubleVal($dt(el('Desking:frm:hidden-vehicle-cost')).val());
					trade_gross      = doubleVal($dt(el('Desking:frm:tradeInput')).val()) - doubleVal($dt(el('Desking:frm:payoff')).val());
					front            = (doubleVal($dt(el('Desking:frm:price')).val()) + trade_gross) - cost;

					back = warrGross + maintGross + afterMarketGross + financeGross + gapGross;
					//alert('direct::'+warrgrsdirect + '/n warrGrass::'+warrgrsdirect);
                    $dt("#be").text(back.toFixed(2));
                    //alert('back' +back);
	    }
        
        </script>

        
        <style type="text/css">

            .nav-tabs {
                margin-bottom: 0;
            }
            .row {
                margin-top: 2px;
            }
            .control-label {
                margin-top: 6px;
            }
            .colhead {
                font-size:14px;
                font-weight:bold;
            }
            .form-control {
                text-align: right;
            }
            .control-label {
                text-align: right;
            }
            .mod-form-control {
                display: inline;
                width: 100%;
                height: 34px;
                padding: 6px 12px;
                font-size: 14px;
                line-height: 1.428571429;
                color: #555555;
                vertical-align: middle;
                background-color: #ffffff;
                background-image: none;
                border: 1px solid #cccccc;
                border-radius: 4px;
                -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
                box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075);
                -webkit-transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;
                transition: border-color ease-in-out 0.15s, box-shadow ease-in-out 0.15s;           
            }
            
            a.mod-form-control {
                display: inline !important;
                width: 25px !important;
                padding: 0px 0px !important;
                margin-left: -25px !important;
                border: none !important;
            }
            .hairline {
                margin-top: 2px !important;
                margin-bottom: 6px !important;
            }
            
            .bPageTitle {
                padding-top: 0px;
                padding-bottom: 0px;
                margin-top: 0px;
                margin-bottom: 0px;
            }
            
            .deal-info-center {
                float: right;
                width: 100%;
                font-size: 18px;
                padding-top: 30px;
                padding-bottom: 0px;
            }
            
            .chatter-location {
                width: 80%;
                display: inline-block;
            }
            
            .page-action {
                float: right;
                margin-top: -30px;
            }
                      
            .sml {
                font-size:10px;
                color: grey;
            }
            
            /*Salesforce overrides*/
            body.header-hidden{
                background: transparent !important;
                margin: 0 0 0 10px !important;
            }
            
            .iframe-wrapper-for-ios{
                overflow: auto !important;
                -webkit-overflow-scrolling:touch !important;
            }
            
            .intro-nevershowagain{
                
                left: 50%;
                position: relative;
                margin-left: -50px;
            }
            
            .intro-nevershowagain a{
                text-decoration: underline;
                color: #015ba7;
            }
            
            #bodyTable{
                padding-bottom: 0px;
            }
            .clear{ clear: both; }

            
            .width100{
                display: inline-block;
                width: 100%;
            }
            
            .outerNoSidebar .noSidebarCell{
                padding: 0px;
            }
            
            .desk {
                
            }
            
            #deal-app {
                background-color: #ffffff !important;
                height:100%; 
                float:left;
                width:100%;
                overflow:auto;
                border: none !important;
                box-shadow: none !important;
                padding-left: 0px;
                margin-bottom: 0px;
                padding-bottom: 20px;
                margin-left: 0px !important;
                margin-right: 0px !important;
            }
            
            #deal-board-header { 
                padding-left: 0;
                padding-right: 0;
                float: left;
                position: relative;
                top: auto;
                margin-bottom: 0;
                width: 100%;
                border-bottom: 1px #d6d6d6 solid;               
            }
            
            .bs #deal-top-header { 
                min-height: 45px;
                margin-bottom: 0px;
                background-color: #E8EEF4;
                border-radius: 0;
                display: inline-block;
                width: 100%;            
            }
            
            .bs #deal-board-header #deal-top-header .toolbar-padding {
                margin-top: 8px;
            }
            
            .bs #deal-board-header #deal-top-left-container {
                padding-right: 14px;
            }
            
            .bs #deal-board-header #deal-top-middle-container{
                padding-left: 0;
            }
            
            .bs #deal-board-header #deal-search-input-group {
                float:right;
                margin-right:8px;
                width: 100%;
                padding-right: 12px;            
            }
            
            .status-container {
                border-left: 1px #d6d6d6 solid;
                border-right: 1px #d6d6d6 solid;
                padding-bottom: 6px;            
            }
            
            .lender { 
                width: 65px;
            }
            
            .gross { 
                width: 50px;
            }
            
            .payment { 
                width: 150px;
            }
            
            .deal-label-container{
                width: -moz-calc(100% - 90px);
                width: -webkit-calc(100% - 90px);
                width: calc(100% - 90px);
            }
            
            #deal-label-project-name{
                font-size:18px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                min-height: 22px;
            }

            .left-text { text-align: left; }

            .modal-dialog {
                width: 900px !important;
            }

            #aftermarket {
                height: 650px;
            }

            .alert-small { 
                border: 1px solid transparent;
                border-radius: 4px;
                padding: 6px 12px;
                margin-bottom: 0px!important;
            }

            .tab-content {
                border-left: 1px solid #eaeaea;
                border-right: 1px solid #eaeaea;
                border-bottom: 1px solid #eaeaea;
                padding: 10px 10px 0px 0px;
                width: -moz-calc(100% - 4px);
                width: -webkit-calc(100% - 4px);
                width: calc(100% - 4px);
                height: -moz-calc(100%);
                height: -webkit-calc(100%);
                height: calc(100%);
                /* border-radius: 0px 0px 4px 4px; */
                background-color: #f8f8f8;
            }
            .tab-style { 
                /* background-color: #B6B6B6; */
            }      

            /* tab color */
            .nav-tabs>li>a {
              background-color: #1797c0; 
              border-color: #eaeaea;
              color:#fff;
              border-radius: 0px 0px 0px 0px !important;
            }

            /* active tab color */
            .nav-tabs>li.active>a, .nav-tabs>li.active>a:hover, .nav-tabs>li.active>a:focus {
              color: #000 !important;
              background-color: #f8f8f8 !important;
              border: 1px solid #eaeaea !important;
              border-bottom: 0px !important;
              border-radius: 0px 0px 0px 0px !important;
            }

            /* hover tab color */
            .nav-tabs>li>a:hover {
              border-color: #eaeaea !important;
              background-color: #cfeef8 !important;
              border-radius: 0px 0px 0px 0px !important;
            } 

            .bodyDiv {
                background-color: #E8EEF4; 
            }
        </style>
    </head>   
<div class="bs" id="deal-app">
<apex:form id="frm">

    <apex:outputpanel id="scriptBlk">
    	 <script>
    	     var iswarrPrem  = "{!iswarrPrem}"; 
             var isMainPrem  = "{!isMainPrem}";
             var isGAPPrem   = "{!isGAPPrem}";
             var isOtherPrem = "{!isOtherPrem}";
            $(window).ready(function() {
               
                $dt(el('gapPremium')).val($dt(el('Desking:frm:gappremium')).val());
                
                if(iswarrPrem == 'true'){
                	 $dt('[id$=warrantyPremium]').prop("disabled","disabled");
                }
                if(isMainPrem == 'true'){
                	$dt('[id$=maintenancePremium]').prop("disabled","disabled");
                }
                if(isGAPPrem == 'true'){
                	$dt('[id$=gapPremium]').prop("disabled","disabled");
                }
                if(isOtherPrem == 'true' || aftermarket > 0){
             		$dt('[id$=aftermarkettotal]').prop("disabled","disabled");
             		 if(!$dt('[id$=afterMarketLabel]').children('i').hasClass('fa fa-calculator fa-lg')){
             		       $dt('[id$=afterMarketLabel]').append('<i class="fa fa-calculator fa-lg" id="faCalIcon"></i>'); 
             		 }
             		$dt('[id$=fapencilIcon]').hide();
             		$dt('[id$=faCalIcon]').show();
	              }else{
	                  $dt('[id$=aftermarkettotal]').prop("disabled", false);
	                  if(!$dt('[id$=afterMarketLabel]').children('i').hasClass('fa fa-pencil fa-lg')){
	             		       $dt('[id$=afterMarketLabel]').append('<i class="fa fa-pencil fa-lg" id="fapencilIcon"></i>'); 
	             		 }
	                   $dt('[id$=faCalIcon]').hide();
	                   $dt('[id$=fapencilIcon]').show();
	                
	              }
	              
	               $dt(el('aftermarkettotal')).val(doubleVal(aftermarket)+doubleVal($dt(el('Desking:frm:hidden-afterMarketGross')).val()));
                /*if(isOtherPrem == 'true' || aftermarket > 0){
                	$dt('[id$=aftermarkettotal]').prop("disabled","disabled");
                	if(!$dt('[id$=afterMarketLabel]').children('i').hasClass('fa fa-calculator fa-lg')){
             		       $dt('[id$=afterMarketLabel]').append('<i class="fa fa-calculator fa-lg"></i>'); 
             		} 
                	$dt('[id$=fapencilIcon]').hide();
                	
                }else{
                   $dt('[id$=faCalIcon]').hide();
                   $dt('[id$=fapencilIcon]').show();
                } */
              
	       });
	       
	       /*function afterMarketDisplay(){
	               	if("{!isOtherPrem}" == 'true' || aftermarket > 0){
	                	$dt('[id$=aftermarkettotal]').prop("disabled","disabled");
	                	if(!$dt('[id$=afterMarketLabel]').children('i').hasClass('fa fa-calculator fa-lg')){
             		       $dt('[id$=afterMarketLabel]').append('<i class="fa fa-calculator fa-lg"></i>'); 
             		    }
                        $dt('[id$=fapencilIcon]').hide();
                        
	                }else{
	                   $dt('[id$=faCalIcon]').hide();
	                   $dt('[id$=fapencilIcon]').show();
	                }
           } */
	        
		 </script>
    </apex:outputpanel>
    <apex:pageMessages id="pgMsg"/>
    
    <apex:inputHidden id="hidden-warrantyGross" value="{!deal.dealer__Ext_Warr_Gross__c}" /> 
    <apex:inputHidden id="hidden-maintGross" value="{!deal.dealer__Maintenance_Gross__c}" />
    <apex:inputHidden id="hidden-afterMarketGross" value="{!deal.dealer__Aftermarket_Gross__c}" />
    <apex:inputHidden id="hidden-financeGross" value="{!deal.dealer__Finance_Gross__c}" />
    <apex:inputHidden id="hidden-gapGross" value="{!deal.dealer__GAP_Gross__c}" />
    <apex:inputHidden id="hidden-vehicle-cost" value="{!deal.dealer__Sale_Cost__c}" /> 
    <apex:inputHidden id="lender-hidden" value="{!dealer__Deal__c.dealer__Finance_Institution_Account__c}" />
    <apex:inputHidden id="lender-name-hidden" value="{!dealer__Deal__c.dealer__Financial_Inst__c}" />
    <apex:inputHidden id="multi-quote-payments" value="{!dealer__Deal__c.dealer__Multi_Quote_Options__c}" />
    <apex:actionFunction name="saveDeal" action="{!save}" reRender="frm">
        <apex:param name="jsonDataToInsert" assignTo="{!jsonDataToInsert}" value="" />
        <apex:param name="tabId" assignTo="{!seletedTabId}" value="" />
    </apex:actionFunction>
    <apex:actionFunction name="redirectToActTab" action="{!returnToDeal}" reRender="frm">
        <apex:param name="tabId" assignTo="{!seletedTabId}" value=""/>
    </apex:actionFunction>
    <apex:actionFunction name="createInventory" action="{!createInventory}">
    </apex:actionFunction>
    <apex:actionfunction name="evaluateBackEndGrossTotal" action="{!findTotalRollup}"  rerender="BackendGrossblk"/> 
    
    <div class="container-fluid" id="deal-board-header">
        <div id="deal-top-header">
          
          <div class="col-xs-12 col-sm-4 col-md-3 col-lg-3 toolbar-padding" id="deal-top-left-container">
            <div class="deal-label-container pull-left">
              <div class="toolbar-dark-color" id="deal-label-project-name" title="">{!HTMLENCODE(dealer__Deal__c.Name)}</div>
            </div>
          </div>
          
          
          
          <div class="col-xs-12 col-sm-8 col-md-7 col-lg-7 toolbar-padding" id="deal-top-middle-container">
            <div class="status-container col-sm-3 lender pull-left" id="deal-lender">
                    <span class="glyphicon glyphicon-briefcase enableTooltip" style="font-size: 14px;" data-toggle="tooltip" data-placement="bottom" title="Financial Institution"></span>
                    <span id="deal-lender-val" style="font-size: 14px;">{!HTMLENCODE(dealer__Deal__c.dealer__Financial_Inst__c)}</span>
            </div>
            <div class="status-container col-sm-2 gross pull-left" id="deal-front-end">
                    <span class="glyphicon glyphicon-pencil enableTooltip" style="font-size: 14px;" data-toggle="tooltip" data-placement="bottom" title="Front End Gross"></span>
                    <span id="fe" style="font-size: 14px;">{!dealer__Deal__c.dealer__Front_End_Gross__c}</span>
            </div>
            <apex:panelGroup id="BackendGrossblk">
            <div class="status-container col-sm-2 gross pull-left" id="deal-back-end">
                    <span class="glyphicon glyphicon-pencil enableTooltip" style="font-size: 14px;" data-toggle="tooltip" data-placement="bottom" title="Back End Gross"></span>
                    <span id="be" style="font-size: 14px;">{!dealer__Deal__c.dealer__Back_End_Gross__c}</span>
            </div>
            </apex:panelGroup>
            <div class="status-container col-sm-2 payment pull-left" id="deal-payment">
                    <span class="glyphicon glyphicon-usd enableTooltip" style="font-size: 14px;" data-toggle="tooltip" data-placement="bottom" title="Monthly Payment"></span>
                    <span id="pymt" style="font-size: 14px;">{!dealer__Deal__c.dealer__Monthly_Pymt__c}</span>
            </div>
            <div class="status-container col-sm-3 status pull-left" id="deal-status">
                <span id="status">
                    <div  role="alert" id="dealStatusAlert" style="text-overflow: ellipsis;">
                        <apex:outputPanel id="inlinePanel">
                            <apex:pageBlock mode="maindetail" id="inlineBlock">
                                <apex:inlineEditSupport >
                                    <apex:pageBlockSection id="inlineBlockSec">
                                        <apex:pageBlockSectionItem dataStyleClass="wrapperClass" id="inlineBlockSecItem">
                                            <apex:outputField id="deal_status" title="Deal Staus, click to change" label="Status" style="display:inline;" value="{!dealer__Deal__c.dealer__Status__c}" />
                                        </apex:pageBlockSectionItem>
                                    </apex:pageBlockSection>
                                </apex:inlineEditSupport>
                            </apex:pageBlock>
                        </apex:outputPanel>
                     </div>
                </span>
            </div>  
          </div>
          
          <div class="hidden-xs col-sm-12 col-md-2 col-lg-2 toolbar-padding">
            <!--
            <div class="salesperson-container pull-left">s1</div>
            <div class="salesperson-container pull-left">s2</div>
            <div class="salesperson-container pull-left">dm</div>
            <div class="salesperson-container pull-left">fi</div>
            -->
            <div class="pull-right">
              <div id="deal-commands">
                    <div class="btn-group">
                        <apex:outputPanel rendered="{!deal.id==null}">
                            <apex:commandButton onclick="saveNewDeal();" oncomplete="redirect();" value="Save" styleClass="btn btn-danger"/>
                            <input type="text" id="focusMeOnSave" style="display:none" />
                        </apex:outputPanel>
                        <apex:commandButton onclick="updateDeal();" oncomplete="redirect();" value="Save" styleClass="btn btn-danger" rendered="{!deal.id!=null}"/>
                        <input type="text" id="focusMeOnUpdate" style="display:none" />
                    </div>
                    <div class="btn-group">
                        <apex:commandButton action="{!newDeal}" value="New Deal" styleClass="btn btn-info" />
                    </div>
              </div>
            </div>
          </div>
          
        </div>
      </div>

    <div id="desk">
        <ul class="nav nav-tabs nav-justified" id="deskingTabs">
<!--             <li><a class="active" id="tab0" href="#purchase" data-toggle="tab" >{!$Label.dealer__DeskingTab1}</a></li> class="active" -->
            <li><a id="tab0" href="#purchase" data-toggle="tab" >{!$Label.dealer__DeskingTab1}</a></li>
            <li><a id="tab1" href="#vehicle" data-toggle="tab" >{!$Label.dealer__DeskingTab2}</a></li>
            <li><a id="tab2" href="#customer" data-toggle="tab" >{!$Label.dealer__DeskingTab3}</a></li>
            <li><a id="tab3" href="#trades" data-toggle="tab" >{!$Label.dealer__DeskingTab4}</a></li>
            <li><a id="tab4" href="#lender" data-toggle="tab" >{!$Label.dealer__DeskingTab5}</a></li>
            <li><a id="tab4a" href="#warranty" data-toggle="tab" >{!$Label.dealer__DeskingTab6}</a></li>
            <li><a id="tab5" href="#aftermarket" data-toggle="tab" >{!$Label.dealer__DeskingTab7}</a></li>
            <li><a id="tab6" href="#insurance" data-toggle="tab" >{!$Label.dealer__DeskingTab8}</a></li>
            <li><a id="tab7" href="#fees" data-toggle="tab" >{!$Label.dealer__DeskingTab9}</a></li>
            <li><a id="tab8" href="#forms" data-toggle="tab" >{!$Label.dealer__DeskingTab10}</a></li>
            <li><a id="tab9" href="#delivery" data-toggle="tab">{!$Label.dealer__DeskingTab11}</a></li> 
            <li><a id="tab10" href="#chatter" data-toggle="tab">Chatter</a></li>
        </ul> <!-- End of tab definition -->

        <div class="tab-content" id="content">
            <!--
            ////////////////////////////////////////////////////////////////////////
            //  DEAL SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->       
            <div class="tab-pane active" id="purchase">
               
               <!-- Row 1 -->
               <div class="row">
                  <div class="col-sm-4">
                    <label for="dealno" class="col-sm-3 control-label">Deal#</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" styleClass="form-control form-disabled" id="dealno" value="{!dealer__Deal__c.dealer__Deal_ID__c}" rendered="{!IF(NOT(ISBLANK(dealer__Deal__c.dealer__Deal_ID__c)), true, false)}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="tradeInput" class="col-sm-3 control-label">Trade(s)</label>
                      <div class="col-sm-7">
                          <div class="input-group">                         
                                <apex:inputField type="text" html-ff="Desking:frm:payoff" styleClass="form-control" id="tradeInput" value="{!dealer__Deal__c.dealer__Trade_Allowance__c}" /> 
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button" id="tradenav">Trade(s)</button>
                                </span> 
                          </div>
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="docFee" class="col-sm-3 control-label">Doc Fee</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:warrantyPremium" styleClass="form-control" id="docFee" value="{!dealer__Deal__c.dealer__Doc_Fee__c}" />
                      </div>
                  </div>
              </div> 
              
               <!-- Row 2 -->
                <div class="row">
                  <div class="col-sm-4">
                    <label for="dealDate" class="col-sm-3 control-label"><apex:outputText value="{!$ObjectType.dealer__Deal__c.fields.dealer__Deal_Date__c.Label}" /></label>
                    <div class="col-sm-7">
                        <apex:inputField type="date" html-ff="Desking:frm:price" styleClass="form-control" id="dealDate" value="{!dealer__Deal__c.dealer__Deal_Date__c}" showDatePicker="false" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="payoff" class="col-sm-3 control-label">Payoff</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:deposit" styleClass="form-control" id="payoff" value="{!dealer__Deal__c.dealer__Trade_Payoff__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
	                  <apex:outputpanel id="warrantyBlk">
	                      <label for="warrantyPremium" class="col-sm-3 control-label" id="warrPremLabel">Warr Premium
	                          <apex:outputpanel rendered="{!iswarrPrem}">
	                                <i class="fa fa-calculator fa-lg"></i>
	                          </apex:outputpanel>
	                          <apex:outputpanel rendered="{!!iswarrPrem}">
	                                <i class="fa fa-pencil fa-lg"></i>
	                          </apex:outputpanel> 
	                      </label>
	                     
	                      <div class="col-sm-7">
	                          <apex:inputField type="text" html-ff="Desking:frm:maintenancePremium" styleClass="form-control" id="warrantyPremium" value="{!dealer__Deal__c.dealer__Warranty_Premium__c}"  />
	                      </div>
	                  </apex:outputpanel>
                  </div>
              </div> 
 
                <!-- Row 3 -->
                <div class="row">
                  <div class="col-sm-4">
                    <label for="stockno" class="col-sm-3 control-label">Stock#</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:price" styleClass="mod-form-control" id="stockno" value="{!dealer__Deal__c.dealer__Vehicle__c}" onchange="setVehicle();" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="deposit" class="col-sm-3 control-label">Deposit</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:down" styleClass="form-control" id="deposit" value="{!dealer__Deal__c.dealer__Deposit__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                   <apex:outputpanel id="maintenanceBlk">
                      <label for="maintenancePremium" class="col-sm-3 control-label" id="mainPremLabel">Maint Premium
                          <apex:outputpanel rendered="{!isMainPrem}">
                                <i class="fa fa-calculator fa-lg"></i>
                          </apex:outputpanel>
                          <apex:outputpanel rendered="{!!isMainPrem}">
                                <i class="fa fa-pencil fa-lg"></i>
                          </apex:outputpanel>
                      </label>
                      
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="gapPremium" styleClass="form-control" id="maintenancePremium" value="{!dealer__Deal__c.dealer__Maintenance_Premium__c}"/>
                      </div>
                   </apex:outputpanel>
                  </div>
              </div>
                
                <!-- Row 4 -->
                <div class="row">
                  <div class="col-sm-4">
                    <div class="col-sm-10">
                        <!-- Vehicle Data Placeholder -->
                        <div style="font-size:10px;color:black;text-align:right;" >
                            <span id="vehicleStatusCode" style="text-align:right;"></span>
                            <span id="vehicleDays" style="text-align:right;width:40px;"></span>
                        </div>
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="down" class="col-sm-3 control-label">Down Pymt</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:rebate" styleClass="form-control" id="down" value="{!dealer__Deal__c.dealer__Down_Pymt__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
	                  <apex:outputpanel id="glbBlk">
	                      <label for="gapPremium" class="col-sm-3 control-label" id="gapPremLabel">{!$ObjectType.Deal__c.fields.GAP_Premium__c.Label}
	                          <apex:outputpanel rendered="{!isGAPPrem}">
	                                <i class="fa fa-calculator fa-lg"></i>
	                          </apex:outputpanel>
	                          <apex:outputpanel rendered="{!!isGAPPrem}">
	                                <i class="fa fa-pencil fa-lg"></i>
	                          </apex:outputpanel> 
	                      </label>
	                      <div class="col-sm-7">
	                          <input type="text" ff="aftermarkettotal" class="form-control" id="gapPremium" value="" />
	                      </div>
	                  </apex:outputpanel>
                  </div>
              </div>

                <!-- Row 5 -->
                <div class="row">
                  <div class="col-sm-4">
                    <label for="price" class="col-sm-3 control-label">Price</label> 
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="discount" styleClass="form-control" id="price" value="{!dealer__Deal__c.dealer__Sale_Price__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="rebate" class="col-sm-3 control-label">Rebate(s)</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:state" styleClass="form-control" id="rebate" value="{!dealer__Deal__c.dealer__Rebate__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                  <apex:outputpanel id="afterMarketBlk">
                      <label for="aftermarkettotal" class="col-sm-3 control-label" id="afterMarketLabel">{!$Label.dealer__DeskingTab7} Total
                        <!-- <apex:outputpanel rendered="{!isOtherPrem}">
                                <i class="fa fa-calculator fa-lg" id="faCalIcon"></i>
                          </apex:outputpanel>
                          <apex:outputpanel rendered="{!!isOtherPrem}">
                                <i class="fa fa-pencil fa-lg" id="fapencilIcon"></i>
                          </apex:outputpanel>   -->
                      </label> 
                      <div class="col-sm-7">
                          <input type="text" class="form-control" id="aftermarkettotal" value="" />
                      </div>
                  </apex:outputpanel> 
                  </div>
              </div>    
                
                <!-- Row 6 -->
                <div class="row">
                  <div class="col-sm-4">
                    <label for="list" class="col-sm-3 control-label">List</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" styleClass="form-control" id="list" value="{!dealer__Deal__c.dealer__List_Price__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="deferred" class="col-sm-3 control-label"><apex:outputText value="{!$Label.Total_Deferred}" /></label>
                      <div class="col-sm-7">
                        <div class="input-group">  
                             <input type="text" class="form-control" id="deferred" value="" />
                             <span class="input-group-btn">
                                <button class="btn btn-default" type="button" id="deferrednav">
                                    <span class="glyphicon glyphicon-edit"></span>
                                </button>
                             </span> 
                         </div>
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <div class="col-sm-3"></div>
                      <div class="col-sm-7">
                            
                            <div class="text-right">
                            <button class="btn btn-info" data-toggle="modal" data-target="#multiQuoteDialog" type="button">Multiple Payment Choices</button>
                            </div>
                            
                      </div>
                  </div>
              </div>                
            
                <!-- Row 7 -->
                <div class="row">
                  <div class="col-sm-4">
                     <label for="list" class="col-sm-3 control-label">Discount</label>
                    <div class="col-sm-7"> 
                        <input ff="Desking:frm:term" id="discount" type="text" value="0" class="form-control" />  
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="totaldown" class="col-sm-3 control-label">Total Down</label>
                      <div class="col-sm-7">
                           <input type="text" class="form-control form-disabled" id="totaldown" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                        <div class="col-sm-3"></div>
                        <div class="col-sm-7">
                            
                            <div class="text-right">
                            <button class="btn btn-info" data-toggle="modal" data-target="#multiVehicleQuote" type="button">Side by Side Comparison</button>   
                            </div>    
                            
                            <!-- SBS Comparison -->
                            <div class="modal fade" id="multiVehicleQuote" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismisss="modal">
                                                <span aria-hidden="true">&times;</span>
                                                <span class="sr-only">Close</span>
                                            </button>
                                            <h4 class="modal-title" id="myModalLabel">Side by Side Comparison</h4>
                                        </div>
                                        <div class="modal-body">
                                            <table class="table">
                                                <tr>
                                                    <th>&nbsp;</th>
                                                    <th>Vehicle 1</th>
                                                    <th>&nbsp;</th>
                                                    <th>Vehicle 2</th>
                                                    <th>&nbsp;</th>
                                                    <th>Vehicle 3</th>
                                                </tr>
                                                <tr>
                                                    <td><b>Description</b></td>
                                                    <td><apex:inputField type="text" styleClass="mod-form-control" id="mqVehicle1" value="{!dealer__Deal__c.dealer__Multi_Quote_Vehicle_1__c}" onChange="mqv('mqVehicle1', 1);" /></td>
                                                    <td></td>
                                                    <td><apex:inputField type="text" styleClass="mod-form-control" id="mqVehicle2" value="{!dealer__Deal__c.dealer__Multi_Quote_Vehicle_2__c}" onChange="mqv('mqVehicle2', 2);" /></td>
                                                    <td></td>
                                                    <td><apex:inputField type="text" styleClass="mod-form-control" id="mqVehicle3" value="{!dealer__Deal__c.dealer__Multi_Quote_Vehicle_3__c}" onChange="mqv('mqVehicle3', 3);" /></td>
                                                </tr>
                                                <tr>
                                                    <td><b>Trim</b></td>
                                                    <td><input id="mvq_trim_1" type="text" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_trim_2" type="text" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_trim_3" type="text" class="form-control" /></td>
                                                </tr>
                                                <tr>
                                                    <td><b>Color</b></td>
                                                    <td><input id="mvq_color_1" type="text" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_color_2" type="text" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_color_3" type="text" class="form-control" /></td>
                                                </tr>
                                                <tr>
                                                    <td><b>Engine</b></td>
                                                    <td><input id="mvq_engine_1" type="text" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_engine_2" type="text" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_engine_3" type="text" class="form-control" /></td>
                                                </tr>                                                                                                      
                                                <tr>
                                                    <td><b>Tranmission</b></td>
                                                    <td><input id="mvq_transmission_1" type="text" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_transmission_2" type="text" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_transmission_3" type="text" class="form-control" /></td>
                                                </tr> 

                                                <tr>
                                                    <td colspan="6"></td>
                                                </tr> 

                                                <!--
                                                <tr>
                                                    <td><b>MSRP</b></td>
                                                    <td><input id="mvq_msrp_1" type="number" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_msrp_2" type="number" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_msrp_3" type="number" class="form-control" /></td>
                                                </tr>
                                                -->

                                                <tr>
                                                    <td><b>Sale Price</b></td>
                                                    <td><input id="mvq_saleprice_1" type="number" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_saleprice_2" type="number" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_saleprice_3" type="number" class="form-control" /></td>
                                                </tr>
                                                <tr>
                                                    <td><b>Discount</b></td>
                                                    <td><input id="mvq_discount_1" type="number" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_discount_2" type="number" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input id="mvq_discount_3" type="number" class="form-control" /></td>
                                                </tr>   
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                    <td></td>
                                                </tr>     
                                                <tr>
                                                    <td colspan="2">1)&nbsp;<input type="number" class="form-control" id="mvq_down_1" placeholder="Down" style="width:85px;display:inline;" />
                                                        <input class="form-control" id="mvq_term_1" style="width:45px;display:inline;" type="text" value="48" />
                                                    <span style="color:#bdc3c7;">Mo.&nbsp;</span>
                                                    <input class="form-control" id="mvq_rate_1" style="width:45px;display:inline;" type="text" value="4.9" />
                                                    <span style="color:#bdc3c7;">APR</span>
                                                    </td>
                                                    <td colspan="2">
                                                        2)&nbsp;<input type="number" class="form-control" id="mvq_down_2"  style="width:85px;display:inline;" placeholder="Down" />
                                                        <input class="form-control" id="mvq_term_2" style="width:45px;display:inline;" type="text" value="60" />
                                                    <span style="color:#bdc3c7;">Mo.&nbsp;</span>
                                                    <input class="form-control" id="mvq_rate_2" style="width:45px;display:inline;" type="text" value="5.9" />
                                                    <span style="color:#bdc3c7;">APR</span>                                                        

                                                    </td>
                                                    <td colspan="2">
                                                        3)&nbsp;
                                                        <input type="number" class="form-control" id="mvq_down_3"  style="width:85px;display:inline;" placeholder="Down" />
                                                            <input class="form-control" id="mvq_term_3" style="width:45px;display:inline;" type="text" value="72" />
                                                        <span style="color:#bdc3c7;">Mo.&nbsp;</span>
                                                        <input class="form-control" id="mvq_rate_3" style="width:45px;display:inline;" type="text" value="6.9" />
                                                        <span style="color:#bdc3c7;">APR</span>                                                        
                                                    </td>
                                                </tr>   

                                                <tr>
                                                    <td>1)&nbsp;</td>
                                                    <td><input type="number" id="mvq_pymt_1_1"  onfocus="mvqCalcOptions(1);" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input type="number" id="mvq_pymt_1_2" onfocus="mvqCalcOptions(1);" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input type="number" id="mvq_pymt_1_3" onfocus="mvqCalcOptions(1);" class="form-control" /></td>                                                                 
                                                </tr>

                                                <tr>
                                                    <td>2)&nbsp;</td>
                                                    <td><input type="number" id="mvq_pymt_2_1" onfocus="mvqCalcOptions(2);" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input type="number" id="mvq_pymt_2_2" onfocus="mvqCalcOptions(2);" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input type="number" id="mvq_pymt_2_3" onfocus="mvqCalcOptions(2);" class="form-control" /></td>                                                                 
                                                </tr>


                                                <tr>
                                                    <td>3)&nbsp;</td>
                                                    <td><input type="number" id="mvq_pymt_3_1" onfocus="mvqCalcOptions(3);" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input type="number" id="mvq_pymt_3_2" onfocus="mvqCalcOptions(3);" class="form-control" /></td>
                                                    <td></td>
                                                    <td><input type="number" id="mvq_pymt_3_3" onfocus="mvqCalcOptions(3);" class="form-control" /></td>                                                                 
                                                </tr>

                                            </table>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                                
                                        </div>
                                    </div>
                                </div>
                                </div>  
                            <!-- End SBS Comparison -->                     
                        </div>  
                    <div class="modal fade" id="multiQuoteDialog" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismisss="modal">
                                    <span aria-hidden="true">&times;</span>
                                    <span class="sr-only">Close</span>
                                </button>
                                <h4 class="modal-title" id="myModalLabel">Mutliple Payment Options</h4>
                            </div>
                            <div class="modal-body">
                                <table class="table">                          
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td>
                                            <b>Plan 1 </b>
                                        </td>
                                        <td>
                                            <b>Plan 2 </b>
                                        </td>
                                        <td>
                                           <b>Plan 3 </b>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><b>Down Payment</b></td>
                                        <td>
 
                                            <input class="form-control" id="MQterm1" style="width:45px;display:inline;" type="text" value="48" />
                                            <span style="color:#bdc3c7;">Mo.&nbsp;</span>
                                            <input class="form-control" id="MQrate1" style="width:45px;display:inline;" type="text" value="4.9" />
                                            <span style="color:#bdc3c7;">APR</span>

                                        </td>
                                        <td>
                                            <input class="form-control" id="MQterm2" style="width:45px;display:inline;" type="text" value="60" />
                                            <span style="color:#bdc3c7;">Mo.&nbsp;</span>
                                            <input class="form-control" id="MQrate2" style="width:45px;display:inline;" type="text" value="5.9" />
                                            <span style="color:#bdc3c7;">APR</span>
                                        </td>
                                        <td>
                                            <input class="form-control" id="MQterm3" style="width:45px;display:inline;" type="text" value="72" />
                                            <span style="color:#bdc3c7;">Mo.&nbsp;</span>
                                            <input class="form-control" id="MQrate3" style="width:45px;display:inline;" type="text" value="6.9" />
                                            <span style="color:#bdc3c7;">APR</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td><input class="form-control" id="MQdown1" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_1_1" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_1_2" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_1_3" style="width:145px;" type="text" value="" /></td>
                                    </tr>
                                    <tr>
                                        <td><input class="form-control" id="MQdown2" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_2_1" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_2_2" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_2_3" style="width:145px;" type="text" value="" /></td>
                                    </tr>
                                    <tr>
                                        <td><input class="form-control" id="MQdown3" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_3_1" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_3_2" style="width:145px;" type="text" value="" /></td>
                                        <td><input class="form-control" id="MQpymt_3_3" style="width:145px;" type="text" value="" /></td>
                                    </tr>                                                            
                                </table>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>                                
                            </div>
                        </div>
                    </div>
                    </div>  
                    <!-- End of MQ -->                        
                  </div>
              </div>     
             
              <!-- Row 8 -->
                <div class="row">
                  <div class="col-sm-4">
                    <label for="term" class="col-sm-3 control-label">Term</label>
                    <div class="col-sm-7">
                        <apex:inputField type="number" html-ff="Desking:frm:rate" styleClass="form-control" id="term" value="{!dealer__Deal__c.dealer__Term__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="state" class="col-sm-3 control-label">State</label>
                      <div class="col-sm-3">
                          <apex:inputField type="text" html-ff="Desking:frm:county" styleClass="form-control" style="text-transform: uppercase;" id="state" value="{!dealer__Deal__c.dealer__Buyer_State__c}" onchange="setTaxRate();" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="amountfinanced" class="col-sm-3 control-label"><apex:outputText value="{!$ObjectType.dealer__Deal__c.fields.dealer__Amt_Financed__c.Label}" /></label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" styleClass="form-control" id="amountfinanced" value="{!dealer__Deal__c.dealer__Amt_Financed__c}" />
                      </div>
                  </div>
              </div>
                
              <!-- Row 9 -->
                <div class="row">
                  <div class="col-sm-4">
                    <label for="rate" class="col-sm-3 control-label">Rate</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:days" styleClass="form-control" id="rate" value="{!dealer__Deal__c.dealer__Rate__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="county" class="col-sm-3 control-label">County</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:countyrate" styleClass="form-control left-text" id="county" value="{!dealer__Deal__c.dealer__County__c}" list="{!TaxZoneCountyList}" onchange="setTaxRate();"  />
                      </div>
                  </div>
                  <div class="col-sm-4"> 
                      <div class="col-sm-7"></div>
                  </div>
              </div>

              <!-- Row 10 -->
                <div class="row">
                  <div class="col-sm-4">
                    <label for="days" class="col-sm-3 control-label">Days</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:paymentsperyear" styleClass="form-control" id="days" value="{!dealer__Deal__c.dealer__Days_to_First__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="countyrate" class="col-sm-3 control-label">Cnty Rate</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:fees" styleClass="form-control" id="countyrate" value="{!dealer__Deal__c.dealer__County_Rate__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="sp1" class="col-sm-3 control-label">SP1</label>
                      <div class="col-sm-7">
                      <!-- Employee Association --> 
                      <apex:outputPanel styleClass="form-control iEdit"> 
                      <apex:outputField id="sp1" value="{!dealer__Deal__c.dealer__Salesperson_1__c}">
                        <apex:inlineEditSupport event="ondblClick" />
                      </apex:outputField>   
                      </apex:outputPanel>                                                     
                      </div>
                  </div>
              </div>
                

              <!-- Row 11 -->
                <div class="row">
                  <div class="col-sm-4">
                      <label for="paymentsperyear" class="col-sm-3 control-label">Pay/Year</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:pymntdate" styleClass="form-control" id="paymentsperyear" value="{!dealer__Deal__c.dealer__Payments_Per_Year__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="fees" class="col-sm-3 control-label">Fees</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:totaltax" styleClass="form-control" id="fees" value="{!dealer__Deal__c.dealer__Total_Fees__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4"> 
                      <label for="sp2" class="col-sm-3 control-label">SP2</label>
                      <div class="col-sm-7">
                      <!-- Employee Association --> 
                      <apex:outputPanel styleClass="form-control iEdit"> 
                      <apex:outputField id="sp2" value="{!dealer__Deal__c.dealer__Salesperson_2__c}">
                        <apex:inlineEditSupport event="ondblClick" />
                      </apex:outputField>   
                      </apex:outputPanel>                                                     
                      </div>                                                       
                  </div>
              </div>
                

              <!-- Row 12 -->
                <div class="row">
                  <div class="col-sm-4">
                    <label for="pymntdate" class="col-sm-3 control-label">Pymt Date</label>
                    <div class="col-sm-7">
                         <apex:inputField type="date" html-ff="Desking:frm:tradeInput" styleClass="form-control" id="pymntdate" value="{!dealer__Deal__c.dealer__First_Payment_Date__c}" showDatePicker="false" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="totaltax" class="col-sm-3 control-label">Taxes</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:warrantyPremium" styleClass="form-control" id="totaltax" value="{!dealer__Deal__c.dealer__Total_Tax__c}"  />
                      </div>
                  </div>
                   
                  <div class="col-sm-4"> 
                      <label for="dm" class="col-sm-3 control-label">Desk Mgr</label>
                      <div class="col-sm-7">
                      <!-- Employee Association --> 
                      <apex:outputPanel styleClass="form-control iEdit"> 
                      <apex:outputField id="dm" value="{!dealer__Deal__c.dealer__Desk_Manager__c}">
                        <apex:inlineEditSupport event="ondblClick" />
                      </apex:outputField>   
                      </apex:outputPanel>                                                     
                      </div>                                                    
                  </div>
              </div>
                

              <!-- Row 13 -->
               <div class="row">
                  <div class="col-sm-4">
                      <label for="salesup" class="col-sm-3 control-label">Sales Up</label>
                      <div class="col-sm-7">
                            <apex:inputField id="salesup" styleClass="mod-form-control" value="{!dealer__Deal__c.dealer__Sales_Lead__c}" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="totaltax" class="col-sm-3 control-label">Buy Rate</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:warrantyPremium" styleClass="form-control" id="buyrate" value="{!dealer__Deal__c.dealer__Buy_Rate__c}"  />
                      </div>
                  </div>
                  <!-- <div class="col-sm-4">
                  </div> -->
                  <div class="col-sm-4">
                      <label for="fm" class="col-sm-3 control-label">FI Mgr</label>
                      <div class="col-sm-7">
                      <!-- Employee Association --> 
                      <apex:outputPanel styleClass="form-control iEdit"> 
                      <apex:outputField id="fm" value="{!dealer__Deal__c.dealer__F_I_Manager__c}">
                        <apex:inlineEditSupport event="ondblClick" />
                      </apex:outputField>   
                      </apex:outputPanel>                                                     
                      </div>                                                    
                  </div>
              </div>
              
              <!-- Row 14 -->
               <div class="row">
                  <div class="col-sm-4">
                      <label for="storeLocaton" class="col-sm-3 control-label">Store Location</label>
                      <div class="col-sm-7">
                            <apex:inputField id="store_location" styleClass="mod-form-control" value="{!dealer__Deal__c.dealer__Store_Location__c}" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                  </div>
                  <div class="col-sm-4">
                      <label for="repairOrder" class="col-sm-3 control-label">Delivery Repair Order</label>
                      <div class="col-sm-7">
                          <apex:outputField id="d_ro" value="{!dealer__Deal__c.dealer__DeliveryRepairOrder__c}"/>                                                                          
                      </div>                                                    
                  </div>
              </div>
            </div> <!-- End of Purchase Screen -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  VEHICLE SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->  
            <div class="tab-pane" id="vehicle">
               <div class="row">
                  <div class="col-md-4">
                    <label for="vehicletype" class="col-sm-3 control-label">Vehicle Type</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="vehicletype" value="{!dealer__Deal__c.dealer__NUO__c}" />
                    </div> 
                  </div>
                  <div class="col-md-4">
                    <label for="vehiclevin" class="col-sm-3 control-label">VIN</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" styleClass="form-control form-disabled" id="vehiclevin" value="{!dealer__Deal__c.dealer__VIN__c}" />
                    </div>
                  </div>
                  <div class="col-md-4">
                      <label for="dealtype" class="col-sm-3 control-label">Deal Type</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" styleClass="form-control" id="dealtype" value="{!dealer__Deal__c.dealer__Deal_Type__c}"  />
                      </div>
                  </div>
              </div>
                
               <div class="row">
                  <div class="col-md-4">
                    <label for="stocknoveh" class="col-sm-3 control-label">Stock#</label>
                    <div class="col-sm-7">
                        <div class="input-group">  
                             <apex:inputField type="text" styleClass="form-control form-disabled" id="stocknoveh" value="{!dealer__Deal__c.dealer__Stock_Number__c}"   />
                             <span class="input-group-btn">
                                <button class="btn btn-default" type="button" id="vehiclenav">
                                    <span class="glyphicon glyphicon-edit"></span>
                                </button>
                             </span> 
                         </div>
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="listpriceveh" class="col-sm-3 control-label">List Price</label>
                      <div class="col-sm-7">
                          <apex:inputField styleClass="form-control form-disabled" id="listpriceveh" value="{!vehicle.dealer__MSRP__c}"  />
                      </div>
                  </div>
              </div>

               <div class="row">
                  <div class="col-md-4">
                    <label for="year" class="col-sm-3 control-label">Year</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="year" value="{!dealer__Deal__c.dealer__Year__c}" />
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="salepriceveh" class="col-sm-3 control-label">Sale Price</label>
                      <div class="col-sm-7">
                          <apex:inputField styleClass="form-control form-disabled" id="salepriceveh" value="{!vehicle.dealer__Coded_Cost__c}"  />
                      </div>
                  </div>
              </div>

               <div class="row">
                  <div class="col-md-4">
                    <label for="make" class="col-sm-3 control-label">Make</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="make" value="{!dealer__Deal__c.dealer__Make__c}" />
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="invoiceprice" class="col-sm-3 control-label">Invoice</label>
                      <div class="col-sm-7">
                          <apex:inputField styleClass="form-control form-disabled" id="invoiceprice" value="{!vehicle.dealer__Invoice_Price__c}"  />
                      </div>
                  </div>
              </div>

               <div class="row">
                  <div class="col-md-4">
                    <label for="model" class="col-sm-3 control-label">Model</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="model" value="{!dealer__Deal__c.dealer__Model__c}" /> <!-- Map to secondary object -->
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="holdback" class="col-sm-3 control-label">Holdback</label>
                      <div class="col-sm-7">
                          <apex:inputField styleClass="form-control form-disabled" id="holdback" value="{!vehicle.dealer__Holdback__c}"  /><!-- Map to secondary object -->
                      </div>
                  </div>
              </div>   
                
               <div class="row">
                  <div class="col-md-4">
                    <label for="trim" class="col-sm-3 control-label">Trim</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="trim" value="{!vehicle.dealer__Trim_Level__c}" /><!-- Map to secondary object -->
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="pack" class="col-sm-3 control-label">Pack</label>
                      <div class="col-sm-7">
                          <apex:inputField styleClass="form-control form-disabled" id="pack" value="{!vehicle.dealer__Pack__c}"  /><!-- Map to secondary object -->
                      </div>
                  </div>
              </div>

               <div class="row">
                  <div class="col-md-4">
                    <label for="color" class="col-sm-3 control-label">Color</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="color" value="{!vehicle.dealer__Exterior_Color__c}" /><!-- Map to secondary object -->
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <div class="col-sm-7"> </div>
                  </div>
              </div>

               <div class="row">
                  <div class="col-md-4">
                    <label for="bodytype" class="col-sm-3 control-label">Body Type</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="bodytype" value="{!vehicle.dealer__Body_Type__c}" />
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="odometer" class="col-sm-3 control-label">Odometer</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" styleClass="form-control" id="odometer" value="{!dealer__Deal__c.dealer__Mileage__c}"  />
                      </div>
                  </div>
              </div>

               <div class="row">
                  <div class="col-md-4">
                    <label for="license" class="col-sm-3 control-label">License</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control" id="license" value="{!dealer__Deal__c.dealer__Licence__c}" />
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <div class="col-sm-7"> </div>
                  </div>
              </div>
                
               <div class="row">
                  <div class="col-md-4">
                    <label for="licexp" class="col-sm-3 control-label">License Exp.</label>
                    <div class="col-sm-7">
                         <apex:inputField type="date" styleClass="form-control" id="licexp" value="{!dealer__Deal__c.dealer__License_Expiration__c}" showDatePicker="false" />
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="memo1" class="col-sm-3 control-label">Memo 1</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" styleClass="form-control form-disabled" id="memo1" value="{!vehicle.dealer__Memo_One__c}"  /><!-- Map to secondary object -->
                      </div>
                  </div>
              </div>                

                
               <div class="row">
                  <div class="col-md-4">
                    <label for="titletype" class="col-sm-3 control-label">Title Type</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="titletype" value="{!vehicle.dealer__Title_Type__c}" /><!-- Map to secondary object -->
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="memo2" class="col-sm-3 control-label">Memo 2</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" styleClass="form-control form-disabled" id="memo2" value="{!vehicle.dealer__Memo_Two__c}"  /><!-- Map to secondary object -->
                      </div>
                  </div>
              </div>    

               <div class="row">
                  <div class="col-md-4">
                    <label for="fueltype" class="col-sm-3 control-label">Fuel Type</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="fueltype" value="{!vehicle.dealer__Fuel_Type__c}" /><!-- Map to secondary object -->
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="keycode1" class="col-sm-3 control-label">Keycode 1</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" styleClass="form-control form-disabled" id="keycode1" value="{!vehicle.dealer__Keyless_Entry_Code__c}"  /><!-- Map to secondary object -->
                      </div>
                  </div>
              </div> 
                
               <div class="row">
                  <div class="col-md-4">
                    <label for="newtires" class="col-sm-3 control-label"># New Tires</label>
                    <div class="col-sm-7">
                         <apex:inputField type="text" styleClass="form-control form-disabled" id="newtires" value="{!vehicle.dealer__New_Tires__c}" /><!-- Map to secondary object -->
                    </div> 
                  </div>
                  <div class="col-md-4">
                      <label for="keycode2" class="col-sm-3 control-label">Keycode 2</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" styleClass="form-control form-disabled" id="keycode2" value="{!vehicle.dealer__Ignition_Key_Code__c}"  /><!-- Map to secondary object -->
                      </div>
                  </div>
              </div>
            </div> <!-- End of vehicle Screen -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  CUSTOMER SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->  
            <div class="tab-pane" id="customer">
                
                <div class="row">
                  <div class="col-sm-4">
                    <div class="col-sm-7 colhead">Buyer</div> 
                  </div>
                  <div class="col-sm-4">
                      <div class="col-sm-7 colhead">Co-Buyer</div>
                  </div>
                  <div class="col-sm-4">
                      <div class="col-sm-7 colhead">Company</div>
                  </div>                   
                </div> 
                <hr class="hairline" />
                <div class="row">
                  <div class="col-sm-4">
                    <label for="buyerLookup" class="col-sm-3 control-label">Lookup</label>
                    <div class="col-sm-7">
                      <apex:inputField type="text" html-ff="Desking:frm:buyerfirst" styleClass="mod-form-control" id="buyerLookup" value="{!dealer__Deal__c.dealer__Buyer_Contact__c}" onchange="setBuyer();" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerLookup" class="col-sm-3 control-label">Lookup</label>
                      <div class="col-sm-7">
                      <apex:inputField type="text" html-ff="Desking:frm:cobuyerfirst" styleClass="mod-form-control" id="cobuyerLookup" value="{!dealer__Deal__c.dealer__Co_Buyer_Contact__c}" onchange="setCoBuyer();" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="companylookup" class="col-sm-3 control-label">Lookup</label>
                      <div class="col-sm-7">
                       <apex:inputField type="text" html-ff="Desking:frm:contractedname" styleClass="mod-form-control" id="companylookup" value="{!dealer__Deal__c.dealer__Buyer__c}" onchange="setBusiness();"/>
                      </div>
                  </div>                   
                </div> 
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyerfirst" class="col-sm-3 control-label">First</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyermiddle" styleClass="form-control" id="buyerfirst" value="{!Deal__c.dealer__Buyer_First_Name__c }" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerfirst" class="col-sm-3 control-label">First</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyermiddle" styleClass="form-control" id="cobuyerfirst" value="{!Deal__c.dealer__Co_Buyer_First_Name__c }"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="contractedname" class="col-sm-3 control-label">Contracted</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:contractedtitle" styleClass="form-control" id="contractedname" value="{!dealer__Deal__c.dealer__Business_Contracting_Name__c}" />
                      </div>
                  </div>                   
                </div>   
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyermiddle" class="col-sm-3 control-label">Middle</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyerlast" styleClass="form-control" id="buyermiddle" value="{!Deal__c.dealer__Buyer_Middle_Name__c }" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyermiddle" class="col-sm-3 control-label">Middle</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyerlast" styleClass="form-control" id="cobuyermiddle" value="{!Deal__c.dealer__Co_Buyer_Middle_Name__c }"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="contractedtitle" class="col-sm-3 control-label">Title</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:contracteddepartment" styleClass="form-control" id="contractedtitle" value="{!dealer__Deal__c.dealer__Business_Title__c}" />
                      </div>
                  </div>                   
                </div>

                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyerlast" class="col-sm-3 control-label">Last</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyeraddress" styleClass="form-control" id="buyerlast" value="{!Deal__c.dealer__Buyer_Last_Name__c }" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerlast" class="col-sm-3 control-label">Last</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyeraddress" styleClass="form-control" id="cobuyerlast" value="{!Deal__c.dealer__Co_Buyer_Last_Name__c }"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="contracteddepartment" class="col-sm-3 control-label">Department</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:contractaddress" styleClass="form-control" id="contracteddepartment" value="{!dealer__Deal__c.dealer__Business_Department__c}" />
                      </div>
                  </div>                   
                </div>
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyeraddress" class="col-sm-3 control-label">Address</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyercity" styleClass="form-control" id="buyeraddress" value="{!dealer__Deal__c.dealer__Buyer_Address__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyeraddress" class="col-sm-3 control-label">Address</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyercity" styleClass="form-control" id="cobuyeraddress" value="{!Deal__c.dealer__Co_Buyer_Address__c }"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="contractaddress" class="col-sm-3 control-label">Address</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:contractedcity" styleClass="form-control" id="contractaddress" value="{!dealer__Deal__c.dealer__Business_Address__c}" />
                      </div>
                  </div>                   
                </div>     
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyercity" class="col-sm-3 control-label">City</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyercounty" styleClass="form-control" id="buyercity" value="{!dealer__Deal__c.dealer__Buyer_City__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyercity" class="col-sm-3 control-label">City</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyercounty" styleClass="form-control" id="cobuyercity" value="{!dealer__Deal__c.dealer__Co_Buyer_City__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="contractedcity" class="col-sm-3 control-label">City</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:contractedcounty" styleClass="form-control" id="contractedcity" value="{!dealer__Deal__c.dealer__Business_City__c}" />
                      </div>
                  </div>                   
                </div>
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyercounty" class="col-sm-3 control-label">County</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyerstate" styleClass="form-control" id="buyercounty" value="{!dealer__Deal__c.dealer__Buyer_County__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyercounty" class="col-sm-3 control-label">County</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyerstate" styleClass="form-control" id="cobuyercounty" value="{!dealer__Deal__c.dealer__Co_Buyer_County__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="contractedcounty" class="col-sm-3 control-label">County</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:contractedstate" styleClass="form-control" id="contractedcounty" value="{!dealer__Deal__c.dealer__Business_County__c}" />
                      </div>
                  </div>                   
                </div>    
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyerstate" class="col-sm-3 control-label">State</label>
                    <div class="col-sm-3" style="display:inline-block">
                        <apex:inputField type="text" html-ff="Desking:frm:buyerpostalcode" styleClass="form-control" style="text-transform: uppercase;" id="buyerstate" value="{!dealer__Deal__c.dealer__Buyer_State__c}" html-maxlength="2"/>
                    </div> 
                    <label for="buyerpostalcode" class="col-sm-1 control-label">Zip</label>
                    <div class="col-sm-3">
                        <apex:inputField type="text" html-ff="Desking:frm:buyerphone" styleClass="form-control" id="buyerpostalcode" value="{!dealer__Deal__c.dealer__Buyer_Postal_Code__c}" />
                    </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerstate" class="col-sm-3 control-label">State</label>
                      <div class="col-sm-3" style="display:inline-block">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyerpostalcode" styleClass="form-control" id="cobuyerstate" value="{!dealer__Deal__c.dealer__Co_Buyer_State__c}"  />
                      </div>
                      <label for="cobuyerpostalcode" class="col-sm-1 control-label">Zip</label>
                      <div class="col-sm-3">
                        <apex:inputField type="text" html-ff="Desking:frm:cobuyerphone" styleClass="form-control" id="cobuyerpostalcode" value="{!dealer__Deal__c.dealer__Co_Buyer_Postal_Code__c}" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="contractedstate" class="col-sm-3 control-label">State</label>
                      <div class="col-sm-3" style="display:inline-block">
                          <apex:inputField type="text" html-ff="Desking:frm:contractedpostalcode" styleClass="form-control" id="contractedstate" value="{!dealer__Deal__c.dealer__Business_State__c}"  />
                      </div>
                      <label for="contractedpostalcode" class="col-sm-1 control-label">Zip</label>
                      <div class="col-sm-3">
                        <apex:inputField type="text" html-ff="Desking:frm:contractedphone" styleClass="form-control" id="contractedpostalcode" value="{!dealer__Deal__c.dealer__Business_Postal_Code__c}" />
                      </div>
                  </div>                   
                </div>   

                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyerphone" class="col-sm-3 control-label">Phone</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyermobile" styleClass="form-control" id="buyerphone" value="{!dealer__Deal__c.dealer__Buyer_Home_Phone__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerphone" class="col-sm-3 control-label">Phone</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyermobile" styleClass="form-control" id="cobuyerphone" value="{!dealer__Deal__c.dealer__Co_Buyer_Home_Phone__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="contractedphone" class="col-sm-3 control-label">Phone</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:brokerlookup" styleClass="form-control" id="contractedphone" value="{!dealer__Deal__c.dealer__Business_Phone__c}" />
                      </div>
                  </div>                   
                </div>   
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyermobile" class="col-sm-3 control-label">Mobile</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyeremail" styleClass="form-control" id="buyermobile" value="{!dealer__Deal__c.dealer__Buyer_Mobile_Phone__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyermobile" class="col-sm-3 control-label">Mobile</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyeremail" styleClass="form-control" id="cobuyermobile" value="{!dealer__Deal__c.dealer__Co_Buyer_Mobile_Phone__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4"></div>                   
                </div>                  

                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyeremail" class="col-sm-3 control-label">Email</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyerdob" styleClass="form-control" id="buyeremail" value="{!dealer__Deal__c.dealer__Buyer_Email__c}" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyeremail" class="col-sm-3 control-label">Email</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyerdob" styleClass="form-control" id="cobuyeremail" value="{!dealer__Deal__c.dealer__Co_Buyer_Email__c}"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <div class="col-sm-7 colhead">Broker</div>
                  </div>                   
                </div>
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyerdob" class="col-sm-3 control-label">DOB</label>
                    <div class="col-sm-7">
                        <apex:inputField type="date" html-ff="Desking:frm:buyerssn" styleClass="form-control" id="buyerdob" value="{!dealer__Deal__c.dealer__Buyer_Birthdate__c}" showDatePicker="false" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerdob" class="col-sm-3 control-label">DOB</label>
                      <div class="col-sm-7">
                          <apex:inputField type="date" html-ff="Desking:frm:cobuyerssn" styleClass="form-control" id="cobuyerdob" value="{!dealer__Deal__c.dealer__Co_Buyer_Birth_Date__c}" showDatePicker="false"  />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="brokerlookup" class="col-sm-3 control-label">Lookup</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:brokername" styleClass="mod-form-control" id="brokerlookup" value="{!dealer__Deal__c.dealer__Broker__c}" onchange="setBroker();" />
                      </div>
                  </div>                   
                </div>   
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyerssn" class="col-sm-3 control-label">SSN</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyergender" styleClass="form-control" id="buyerssn" value="{!dealer__Deal__c.dealer__Buyer_Social_Security_Number__c}"/>
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerssn" class="col-sm-3 control-label">SSN</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyergender" styleClass="form-control" id="cobuyerssn" value="{!dealer__Deal__c.dealer__Co_Buyer_Social_Security_Number__c}" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="brokername" class="col-sm-3 control-label">Contracted</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:brokertitle" styleClass="mod-form-control" id="brokername" value="{!dealer__Deal__c.dealer__Broker_Contracting_Name__c}" />
                      </div>
                  </div>                   
                </div>  
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyergender" class="col-sm-3 control-label">Gender</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyerlicno" styleClass="form-control" id="buyergender" value="{!dealer__Deal__c.dealer__Buyer_Gender__c}"/>
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyergender" class="col-sm-3 control-label">Gender</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyerlicno" styleClass="form-control" id="cobuyergender" value="{!dealer__Deal__c.dealer__Co_Buyer_Gender__c}" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="brokertitle" class="col-sm-3 control-label">Title</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:brokerdept" styleClass="mod-form-control" id="brokertitle" value="{!dealer__Deal__c.dealer__Broker_Title__c}" />
                      </div>
                  </div>                   
                </div>   
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyerlicno" class="col-sm-3 control-label">Driver's License</label>
                    <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:buyerliceexp" styleClass="form-control" id="buyerlicno" value="{!dealer__Deal__c.dealer__Buyer_Drivers_License__c}"/>
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerlicno" class="col-sm-3 control-label">Driver's License</label>
                      <div class="col-sm-7">
                          <apex:inputField type="text" html-ff="Desking:frm:cobuyerliceexp" styleClass="form-control" id="cobuyerlicno" value="{!dealer__Deal__c.dealer__Co_Buyer_Drivers_License_Number__c}" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="brokerdept" class="col-sm-3 control-label">Department</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:brokeraddress" styleClass="mod-form-control" id="brokerdept" value="{!dealer__Deal__c.dealer__Broker_Department__c}" />
                      </div>
                  </div>                   
                </div>
                
                <div class="row">
                  <div class="col-sm-4">
                     <label for="buyerliceexp" class="col-sm-3 control-label">Lic Exp</label>
                    <div class="col-sm-7">
                        <apex:inputField type="date" html-ff="Desking:frm:cobuyerLookup" styleClass="form-control" id="buyerliceexp" value="{!dealer__Deal__c.dealer__Buyer_Drivers_License_Exp_Date__c}" showDatePicker="false" />
                    </div> 
                  </div>
                  <div class="col-sm-4">
                      <label for="cobuyerliceexp" class="col-sm-3 control-label">Lic Exp</label>
                      <div class="col-sm-7"> 
                          <apex:inputField type="date" html-ff="Desking:frm:companylookup" styleClass="form-control" id="cobuyerliceexp" value="{!dealer__Deal__c.dealer__Co_Buyer_Drivers_License_Exp_Date__c}" showDatePicker="false" />
                      </div>
                  </div>
                  <div class="col-sm-4">
                      <label for="brokeraddress" class="col-sm-3 control-label">Address</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:brokercity" styleClass="mod-form-control" id="brokeraddress" value="{!dealer__Deal__c.dealer__Broker_Address__c}" />
                      </div>
                  </div>                   
                </div> 
               
                <div class="row">
                  <div class="col-sm-4"><div class="col-sm-7"> </div> </div>
                  <div class="col-sm-4"><div class="col-sm-7"> </div> </div>
                  <div class="col-sm-4">
                      <label for="brokercity" class="col-sm-3 control-label">City</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:brokercounty" styleClass="mod-form-control" id="brokercity" value="{!dealer__Deal__c.dealer__Broker_City__c}" />
                      </div>
                  </div>                   
                </div>    
                
                <div class="row">
                  <div class="col-sm-4"><div class="col-sm-7"> </div> </div>
                  <div class="col-sm-4"><div class="col-sm-7"> </div> </div>
                  <div class="col-sm-4">
                      <label for="brokercounty" class="col-sm-3 control-label">County</label>
                      <div class="col-sm-7">
                        <apex:inputField type="text" html-ff="Desking:frm:brokerstate" styleClass="mod-form-control" id="brokercounty" value="{!dealer__Deal__c.dealer__Broker_County__c}" />
                      </div>
                  </div>                   
                </div>
                
                <div class="row">
                  <div class="col-sm-4"><div class="col-sm-7"> </div> </div>
                  <div class="col-sm-4"><div class="col-sm-7"> </div> </div>
                  <div class="col-sm-4">
                        <label for="brokerstate" class="col-sm-3 control-label">State</label>
                          <div class="col-sm-3" style="display:inline-block">
                              <apex:inputField type="text" html-ff="Desking:frm:brokerpostalcode" styleClass="form-control" id="brokerstate" value="{!dealer__Deal__c.dealer__Broker_State__c}"  />
                          </div>
                          <label for="brokerpostalcode" class="col-sm-1 control-label">Zip</label>
                          <div class="col-sm-3">
                            <apex:inputField type="text" styleClass="form-control" id="brokerpostalcode" value="{!dealer__Deal__c.dealer__Broker_Postal_Code__c}" />
                          </div>
                  </div>                   
                </div>                 
            </div> <!-- End of Customer Screen -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  TRADE SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->  
            <div class="tab-pane" id="trades">
                <div class="row">
                    <div class="col-sm-12">
                        <input type="hidden" id="trade1_ID" value="" />
                        <input type="hidden" id="trade2_ID" value="" />
                        <input type="hidden" id="trade3_ID" value="" />
                        <table class="table">
                            <tr>
                                <th></th>
                                <th>Trade 1&nbsp;<span id="saveTrade1_Alert"></span></th>
                                <th>Trade 2&nbsp;<span id="saveTrade2_Alert"></span></th>
                                <th>Trade 3&nbsp;<span id="saveTrade3_Alert"></span></th>
                                <th>Total</th>
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">Lost</th>
                                <td>
                                    <div class="make-switch">
<!--                                        <input id="trade1Lost" class="cmn-toggle cmn-toggle-round" type="checkbox"/> -->
                                        <input id="trade1Lost" type="checkbox" />
                                        <label for="trade1Lost"></label>
                                    </div>
                                </td>
                                <td>
                                    <div class="switch">
<!--                                        <input id="trade2Lost" class="cmn-toggle cmn-toggle-round" type="checkbox"/> -->
                                        <input id="trade2Lost" type="checkbox"/>
                                        <label for="trade2Lost"></label>
                                    </div>
                                </td>
                                <td>
                                    <div class="switch">
<!--                                        <input id="trade3Lost" class="cmn-toggle cmn-toggle-round" type="checkbox"/> -->
                                        <input id="trade3Lost" type="checkbox"/>
                                        <label for="trade3Lost"></label>
                                    </div>
                                </td>
                                <td></td>                                                                                                                
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">Service Vehicle</th>
                                <td>
                                    <apex:outputLink id="trade1Vehicle" value="" onclick="urlOpener($dt(el('Desking:frm:trade1Vehicle')).val());" target="_blank" >
                                        <span id="trade1SVYear" style="padding-left:4px;"></span>
                                        <span id="trade1SVMake" style="padding-left:4px;"></span>
                                        <span id="trade1SVModel" style="padding-left:4px;"></span>
                                    </apex:outputLink>
                                </td>
                                <td>
                                    <apex:outputLink id="trade2Vehicle" value="" onclick="urlOpener($dt(el('Desking:frm:trade2Vehicle')).val());" target="_blank">
                                        <span id="trade2SVYear" style="padding-left:4px;"></span>
                                        <span id="trade2SVMake" style="padding-left:4px;"></span>
                                        <span id="trade2SVModel" style="padding-left:4px;"></span>
                                    </apex:outputLink>
                                </td>
                                <td>
                                    <apex:outputLink id="trade3Vehicle" value="" onclick="urlOpener($dt(el('Desking:frm:trade3Vehicle')).val());" target="_blank">
                                        <span id="trade3SVYear" style="padding-left:4px;"></span>
                                        <span id="trade3SVMake" style="padding-left:4px;"></span>
                                        <span id="trade3SVModel" style="padding-left:4px;"></span>
                                    </apex:outputLink>
                                </td>
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">Allow</th>
                                <td>
                                    <input type="text" ff="trade1Payoff" class="form-control" placeholder="Trade 1 Allowance" id="trade1Allow" value="" />
                                </td>
                                <td>
                                    <input type="text" ff="trade2Payoff" class="form-control" placeholder="Trade 2 Allowance" id="trade2Allow" value="" />
                                </td>
                                <td>
                                    <input type="text" ff="trade3Payoff" class="form-control" placeholder="Trade 3 Allowance" id="trade3Allow" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Total Trade Allowance" id="totalTradeAllow" value="" />
                                </td>
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">Payoff</th>
                                <td>
                                    <input type="text" ff="trade1ACV" class="form-control" placeholder="Trade 1 Payoff" id="trade1Payoff" value="" />
                                </td>
                                <td>
                                    <input type="text" ff="trade2ACV" class="form-control" placeholder="Trade 2 Payoff" id="trade2Payoff" value="" />
                                </td>
                                <td>
                                    <input type="text" ff="trade3ACV" class="form-control" placeholder="Trade 3 Payoff" id="trade3Payoff" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Total Trade Payoff" id="totalTradePayoff" value="" />
                                </td>
                            </tr>

                            <tr>
                                <th style="vertical-align: middle !important;">Net</th>
                                <td>
                                    <input type="text" class="form-control" placeholder="Trade 1 Net" id="trade1Net" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Trade 2 Net" id="trade2Net" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Trade 3 Net" id="trade3Net" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Total Trade Net" id="totalTradeNet" value="" />
                                </td>
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">ACV</th>
                                <td>
                                    <input type="text" ff="trade1Stock" class="form-control" placeholder="Trade 1 ACV" id="trade1ACV" value="" />
                                </td>
                                <td>
                                    <input type="text" ff="trade2Stock" class="form-control" placeholder="Trade 2 ACV" id="trade2ACV" value="" />
                                </td>
                                <td>
                                    <input type="text" ff="trade3Stock" class="form-control" placeholder="Trade 3 ACV" id="trade3ACV" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Total Trade ACV" id="totalTradeACV" value="" />
                                </td>
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">Over/Under</th>
                                <td>
                                    <input type="text" class="form-control" placeholder="Trade 1 Over/Under" id="trade1OverUnder" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Trade 2 Over/Under" id="trade2OverUnder" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Trade 3 Over/Under" id="trade3OverUnder" value="" />
                                </td>
                                <td>
                                    <input type="text" class="form-control" placeholder="Total Trade Over/Under" id="totalTradeOverUnder" value="" />
                                </td>
                            </tr>
                           
                            <tr>
                                <th style="vertical-align: middle !important;">VIN</th>
                                <td><input type="text" ff="trade1Mileage" id="trade1VIN" class="form-control" placeholder="Trade 1 VIN" /></td>
                                <td><input type="text" ff="trade2Mileage" id="trade2VIN" class="form-control" placeholder="Trade 2 VIN" /></td>
                                <td><input type="text" ff="trade3Mileage" id="trade3VIN" class="form-control" placeholder="Trade 3 VIN" /></td>
                                <td></td>                                                                                                                
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">Odometer</th>
                                <td><input type="text" ff="trade1YearInput" id="trade1Mileage" class="form-control" placeholder="Trade 1 Odom" /></td>
                                <td><input type="text" ff="trade2YearInput" id="trade2Mileage" class="form-control" placeholder="Trade 2 Odom" /></td>
                                <td><input type="text" ff="trade3YearInput" id="trade3Mileage" class="form-control" placeholder="Trade 3 Odom" /></td>
                                <td></td>                                                                                                                
                            </tr>  
                            <tr>
                                <th style="vertical-align: middle !important;">Year</th>
                                <td><input type="text" ff="trade1MakeInput" id="trade1YearInput" class="form-control" placeholder="Trade 1 Year" /></td>
                                <td><input type="text" ff="trade2MakeInput" id="trade2YearInput" class="form-control" placeholder="Trade 2 Year" /></td>
                                <td><input type="text" ff="trade3MakeInput" id="trade3YearInput" class="form-control" placeholder="Trade 3 Year" /></td>
                                <td></td>                                                                                                                
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">Make</th>
                                <td><input type="text" ff="trade1ModelInput" id="trade1MakeInput" class="form-control" placeholder="Trade 1 Make" /></td>
                                <td><input type="text" ff="trade2ModelInput" id="trade2MakeInput" class="form-control" placeholder="Trade 2 Make" /></td>
                                <td><input type="text" ff="trade3ModelInput" id="trade3MakeInput" class="form-control" placeholder="Trade 3 Make" /></td>
                                <td></td>                                                                                                                
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;">Model</th>
                                <td><input type="text" ff="trade2Allow" id="trade1ModelInput" class="form-control" placeholder="Trade 1 Model" /></td>
                                <td><input type="text" ff="trade3Allow" id="trade2ModelInput" class="form-control" placeholder="Trade 2 Model" /></td>
                                <td><input type="text" id="trade3ModelInput" class="form-control" placeholder="Trade 3 Model" /></td>
                                <td></td>                                                                                                                
                            </tr>
                                                        <!-- *********** Payoff Account ********************************************* -->
                            <tr>
                                <th style="vertical-align: middle !important;">Payoff Account</th>
                                <td>
                                    <apex:inputField value="{!up1.dealer__Customer_Account__c}" styleClass="mod-form-control"  id="trade1PayoffAccount"/>
<!--                                     <input type="text" ff="trade1ACV" class="form-control" placeholder="Trade 1 Payoff Account" id="trade1PayoffAccount" value="" /> -->
                                </td>
                                <td>
                                    <apex:inputField value="{!up2.dealer__Customer_Account__c}" styleClass="mod-form-control"  id="trade2PayoffAccount"/>
<!--                                     <input type="text" ff="trade2ACV" class="form-control" placeholder="Trade 2 Payoff Account" id="trade2PayoffAccount" value="" /> -->
                                </td>
                                <td>
                                    <apex:inputField value="{!up3.dealer__Customer_Account__c}" styleClass="mod-form-control" id="trade3PayoffAccount"/>
<!--                                     <input type="text" ff="trade3ACV" class="form-control" placeholder="Trade 3 Payoff Account" id="trade3PayoffAccount" value="" /> -->
                                </td>
                            </tr>
                            
                            <tr>
                                <th style="vertical-align: middle !important;">Pay Off Account Number</th>
                                <td><input type="text" ff="trade1payOffAccNumInput" id="trade1payOffAccNumInput" class="form-control" placeholder="Trade 1 Payoff Account Number" /></td>
                                <td><input type="text" ff="trade2payOffAccNumInput" id="trade2payOffAccNumInput" class="form-control" placeholder="Trade 2 Payoff Account Number" /></td>
                                <td><input type="text" ff="trade3payOffAccNumInput" id="trade3payOffAccNumInput" class="form-control" placeholder="Trade 3 Payoff Account Number" /></td>
                                <td></td>                                                                                                                
                            </tr>
                            
                            <tr>
                                <th style="vertical-align: middle !important;">Pay Off Expiration Date</th>
                                <td>
                                    <input type="date" ff="trade1ACV" class="form-control" placeholder="Trade 1 Payoff Expiration" id="trade1PayoffExp" value="" />
                                </td>
                                <td>
                                    <input type="date" ff="trade2ACV" class="form-control" placeholder="Trade 2 Payoff Expiration" id="trade2PayoffExp" value="" />
                                </td>
                                <td>
                                    <input type="date" ff="trade3ACV" class="form-control" placeholder="Trade 3 Payoff Expiration" id="trade3PayoffExp" value="" />
                                </td>
                            </tr>
                             <tr>
                                <th style="vertical-align: middle !important;">Stock</th>
                                <td><input type="text" ff="trade1VIN" id="trade1Stock" class="form-control" placeholder="Trade 1 Stock" /></td>
                                <td><input type="text" ff="trade2VIN" id="trade2Stock" class="form-control" placeholder="Trade 2 Stock" /></td>
                                <td><input type="text" ff="trade3VIN" id="trade3Stock" class="form-control" placeholder="Trade 3 Stock" /></td>
                                <td></td>                                                                                                                
                            </tr>
                            <tr id="stockVehId">
                                <th style="vertical-align: middle !important;">Vehicle Inventory</th>
                                <td>
                                    <apex:outputLink id="trade1StockVehId" value="" onclick="urlOpener($dt(el('Desking:frm:trade1StockVehId')).val());" target="_blank">
                                        <span id="trade1StockVal" style="padding-left:4px;"></span>
                                    </apex:outputLink>
                                </td>
                                <td>
                                    <apex:outputLink id="trade2StockVehId" value="" onclick="urlOpener($dt(el('Desking:frm:trade2StockVehId')).val());" target="_blank">
                                        <span id="trade2StockVal" style="padding-left:4px;"></span>
                                    </apex:outputLink>
                                </td>
                                <td>
                                    <apex:outputLink id="trade3StockVehId" value="" onclick="urlOpener($dt(el('Desking:frm:trade3StockVehId')).val());" target="_blank">
                                        <span id="trade3StockVal" style="padding-left:4px;"></span>
                                    </apex:outputLink>
                                </td>
                            </tr>
                            <tr>
                                <th style="vertical-align: middle !important;"></th>
                                <td><apex:outputLink id="trade1AppraisalVeh" value=""/></td>
                                <td><apex:outputLink id="trade2AppraisalVeh" value=""/></td>
                                <td><apex:outputLink id="trade3AppraisalVeh" value=""/></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div> <!-- End of Trades Screen -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  LENDER SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->              
            <div class="tab-pane" id="lender">
                <div class="row">
                    <div class="col-sm-10">
                    <label for="lenderName" class="col-sm-3 control-label">Lender</label>
                    <div class="col-sm-4">
                        <apex:inputText value="{!dealer__Deal__c.Finance_Institution_Account__r.Name}" styleClass="form-control form-disabled" id="lenderName" />
                    </div>
                    <div class="col-sm-5" >
                    <apex:selectList value="{!lender}" multiselect="false" size="1" id="bank" styleClass="form-control" onchange="setFinanceCompany();">
                        <apex:selectOptions value="{!financecompanies}" />
                    </apex:selectList>    
                    </div>
                    </div>    
                </div>
                <div class="row" style="height:25px;"></div>
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-2">
                        <b>Deferred Payment(s)</b>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-2">
                        <b>Amount</b>
                    </div>
                    <div class="col-sm-2">
                        <b>Due Date</b>
                    </div>  
                    <div class="col-sm-2">
                        <b>Payee Notes</b>
                    </div>
                    <div class="col-sm-2">
                        <b>Check#/Ref#</b>
                    </div>
                    <div class="col-sm-2">
                        <b>3rd Party Payer</b>
                    </div>                  
                </div>                 
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Down_1__c}" id="deferred_1" />
                    </div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Date_1__c}" />
                    </div>  
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Note_1__c}" />
                    </div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Reference_1__c}" />
                    </div>                    
                    <div class="col-sm-2">
                        <apex:inputField styleClass="mod-form-control" value="{!dealer__Deal__c.dealer__Deferred_1_Payee__c}" />
                    </div>                  
                </div>   
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Down_2__c}" id="deferred_2"/>
                    </div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Date_2__c}" />
                    </div>  
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Note_2__c}" />
                    </div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Reference_2__c}" />
                    </div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="mod-form-control" value="{!dealer__Deal__c.dealer__Deferred_2_Payee__c}" />
                    </div>                  
                </div>
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Down_3__c}" id="deferred_3" />
                    </div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Date_3__c}" />
                    </div>  
                     <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Note_3__c}" />
                    </div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Deferred_Reference_3__c}" />
                    </div>
                    <div class="col-sm-2">
                        <apex:inputField styleClass="mod-form-control" value="{!dealer__Deal__c.dealer__Deferred_3_Payee__c}" />
                    </div>                  
                </div>
                
                <div class="row">
                    <div class="col-sm-10" style="height: 20px;"><hr /></div>
                </div>

                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-2">
                        <b>Additional Payment(s)</b>
                    </div>
                </div>
                <!-- Payment List -->
                <div class="row">
                <div class="col-sm-2"></div>
                <div class="col-sm-8">
                <apex:pageBlock >
                <apex:pageBlockTable value="{!dealPayments}" var="payment">
                    <apex:column >
                        <apex:outputLink value="/{!payment.Id}"><apex:outputText value="{!payment.Name}" /></apex:outputLink>
                    </apex:column>
                    <apex:column value="{!payment.dealer__Amount__c}" />
                    <apex:column value="{!payment.dealer__Due_Date__c}" />
                    <apex:column value="{!payment.dealer__Notes__c}" />
                    <apex:column value="{!payment.dealer__Received__c}" />
                    <apex:column value="{!payment.dealer__Reference__c}" />
                </apex:pageBlockTable>
                </apex:pageBlock>
                </div>
                </div>

                <div class="row">
                    <div class="col-sm-2"></div>
                    <div class="col-sm-8"> 
                        <apex:commandButton action="{!newDealPayment}" value="Add Payment" styleClass="btn btn-info" disabled="{!IF(ISBLANK(deal.Id),true,false)}" />         
                    </div>
                </div>                                                       
            </div> <!-- End of Lender Screen -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  WARRANTY SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->              
            
            <div class="tab-pane" id="warranty">
                <apex:outputpanel rendered="{!deal.id == null}">
		              <div class="alert alert-warning" role="alert">
						  <b>Warning!</b>You must save the deal before adding warranty products
					   </div>
                </apex:outputpanel>
                <apex:outputPanel rendered="{!deal.id != null}">
                <apex:pageBlock mode="maindetail">
                    <div class="row">
                        <apex:pageBlockSection title="Chosen Products" columns="1">
		                <apex:actionStatus onstart="escRemoveStart();" onstop="escRemoveEnd();" id="escRemoveStatus" />
		                <apex:outputPanel id="escSales">
		                <apex:outputPanel rendered="{!soldOnProposal.size >0}">
		                <apex:pageBlockTable var="esc" value="{!soldOnProposal}">                   
		                        <apex:column headerValue="Action">
		                            <apex:commandLink action="{!deleteProduct}" value="Remove" reRender="scriptBlk,escSales,warrantyBlk,maintenanceBlk,glbBlk,afterMarketBlk,gappremium,hidden-afterMarketGross" status="escRemoveStatus" oncomplete="calcGrossOnload();">
		                                <apex:param value="{!esc.Id}" assignTo="{!deleteProductId}" name="delete_product_id" />
		                            </apex:commandLink>
		                        </apex:column>
		                        <apex:column >
		                            <apex:facet name="header">Name</apex:facet>
		                            <apex:outputLink value="/{!esc.Id}"><apex:outputText value="{!esc.Name}" /></apex:outputLink>
		                        </apex:column>
		                        <apex:column headerValue="Code" value="{!esc.dealer__Plan_Code__c}" />
		                        <apex:column headerValue="Description" value="{!esc.dealer__Description__c}" />
		<!--                         <apex:column headerValue="Exp. Miles" value="{!esc.dealer__Expiration_Mileage__c}" /> -->
		<!--                         <apex:column headerValue="Exp. Mo." value="{!esc.dealer__Expiration_Months__c}" /> -->
		                        <apex:column headerValue="Product Type" value="{!esc.dealer__Type__c}" />
		                        <apex:column headerValue="Sale Price" headerClass="aright">
		                            <apex:inputField value="{!esc.dealer__Sale_Price__c}" id="escSalePrice" html-recordId="{!esc.Id}" onchange="updateServiceContractSale(this,'saleprice');" styleClass="aright" />
		                        </apex:column> 
		                        <apex:column headerValue="Cost" headerClass="aright">
		                            <apex:inputField value="{!esc.dealer__Cost__c}" id="costPrice" html-recordId="{!esc.Id}" onchange="updateServiceContractSale(this,'costprice');" styleClass="aright" />
		                        </apex:column>
		                        <apex:column headerValue="Gross" headerClass="aright">
		                            <apex:inputField value="{!esc.dealer__Gross__c}" id="grossPrice" html-recordId="{!esc.Id}" styleClass="aright" />
		                        </apex:column>
		                </apex:pageBlockTable>
		                </apex:outputPanel>
		                </apex:outputPanel>
		                <!-- Modal for the removal of an ESC product -->
		                <div class="modal fade" id="removeESCModal" role="dialog">
		                  <div class="modal-dialog modal-sm">
		                    <div class="modal-content">
		                      <div class="modal-header">
		                        <h4 class="modal-title">Service Contract</h4>
		                      </div>
		                      <div class="modal-body">
		                        <p>Please Wait...</p>
		                      </div>
		                    </div>
		                  </div>
		                </div>                
		            </apex:pageBlockSection>
		                        <apex:pageBlockSection title="Available Products" columns="1" id="availProdcts"/>
		                        <div class="col-sm-12">
		                            <table class="table">
		                                <tr>
		                                    <th>Description</th>
		                                    <th>Code</th>
		                                    <th>Product Type</th>
		                                    <th></th>
		                                    <th></th>
		                                </tr>
		                                <tr>
		                                    <td><apex:inputText id="searchDescription" value="{!escDescription}" styleClass="form-control" /></td>
		                                    <td><apex:inputText id="searchByCode" value="{!escCode}" styleClass="form-control" /></td>
		<!--                                    <td><apex:outputText id="searchType" value="{!escType}" /></td> -->
		                                    <td><apex:selectList id="contractType" value="{!selectedContractType}" size="1" styleClass="form-control" >
		                                        <apex:selectOptions value="{!contractTypes}"/>
		                                    </apex:selectList></td>
		                                    <td><apex:commandButton action="{!searchESC}" value="Search" reRender="escSearchResults, infoMsg" styleClass="btn btn-primary btn-sm" status="escRemoveStatus"></apex:commandButton></td>   
		                                    <td><apex:commandButton action="{!resetResult}" value="Reset" reRender="escSearchResults, searchDescription, searchByCode, contractType, infoMsg" styleClass="btn btn-primary btn-sm"></apex:commandButton></td>                    
		                                </tr>
		                            </table>
		                        
		                        <apex:pageBlockSection columns="1" id="escSearchResults">
		                            <apex:pageBlockTable var="esc" value="{!escResults}">
		                                <apex:column >
		                                    <apex:commandLink value="Select" action="{!selectProduct}" reRender="scriptBlk,escSales,escSearchResults,warrantyBlk,maintenanceBlk,glbBlk,afterMarketBlk,gappremium,hidden-afterMarketGross" status="escRemoveStatus" oncomplete="calcGrossOnload();">
		                                        <apex:param name="escSelectedId" assignTo="{!escSelectedId}" value="{!esc.Id}"/>
		                                    </apex:commandLink>
		                                </apex:column>
		                                <apex:column value="{!esc.Name}" />
		                                <apex:column value="{!esc.dealer__Plan_Code__c}" />
		                                <apex:column value="{!esc.dealer__Description__c}" />
		                                <apex:column value="{!esc.dealer__Expiration_Mileage__c}" />
		                                <apex:column value="{!esc.dealer__Expiration_Months__c}" />
		                                <apex:column value="{!esc.dealer__Sale_Price__c}" />
		                            </apex:pageBlockTable>
		                        </apex:pageBlockSection>
		                        <apex:outputPanel id="infoMsg">
		                            <apex:outputPanel rendered="{!escResults.size == 0}">
		                                <apex:outputLabel value="There are no records"/>
		                            </apex:outputPanel>
		                        </apex:outputPanel> 
		                    </div>  
		                    </div>
		                    <!-- 
		                    <div class="row">
		                        <div class="col-sm-12">
		                        <table class="table">
		                            <tr>
		                                <th>Description</th>
		                                <th>Exp. Months</th>
		                                <th>Exp. Miles</th>
		                                <th>Start Date</th>
		                                <th>End Date</th>
		                                <th>Plan Price</th>
		                                <th>Sale Price</th>
		                                <th>&nbsp;</th>
		                            </tr>
		    
		                            <apex:repeat value="{!avaialbleContracts}" id="contract_repeat" var="ac">
		                            <tr>
		                                <td><apex:outputText id="service_contract_description" styleClass="form-control" value="{!ac.Description__c}" /></td>
		                                <td><apex:inputText id="service_contract_term" styleClass="form-control" value="{!ac.Expiration_Months__c}" /></td>
		                                <td><apex:inputText id="service_contract_miles" styleClass="form-control" value="{!ac.Expiration_Mileage__c}" /></td>
		                                <td><input id="start_date:{!ac.Id}" class="form-control" value="" type="date" /></td>
		                                <td><input id="exp_date:{!ac.Id}" class="form-control" value="" type="date" /></td>
		                                <td><apex:outputText styleClass="form-control" value="{!ac.Sale_Price__c}" /></td>
		                                <td><input class="form-control" id="service_contract_template:{!ac.Id}" svcid="{!ac.Id}" value="" /></td>
		                                <td>
		                                    <input type="hidden" id="service_contract_cost:{!ac.Id}" value="{!ac.dealer__Cost__c}" />
		                                    <span id="service_contract_status:{!ac.Id}"></span>
		                                </td>
		                            </tr>
		                            </apex:repeat>
		                        </table>
		                        </div>
		                    </div>
		                    -->
		                </apex:pageBlock>
		                <div class="row">
		                    <div class="col-sm-12">
		                    <apex:pageBlock mode="maindetail" id="warrantyBlock">
		                        <apex:pageBlockSection title="Additional Warranty Information" collapsible="false">
		                          <apex:repeat value="{!$ObjectType.dealer__Deal__c.FieldSets.dealer__Warranty_Information}" var="wif">
		                              <apex:inputField styleClass="form-control" value="{!dealer__Deal__c[wif]}" />
		                          </apex:repeat>
		                        </apex:pageBlockSection> 
                    </apex:pageBlock> 
                      
                    </div>
                </div>
                </apex:outputpanel> 
            </div>  

            <!-- End of Warranty Screen -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  AFTERMARKET SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->
            <div class="tab-pane" id="aftermarket">
                <div class="row">
                    <div class="col-md-8" style="margin-left:150px;">
                    <!--
                        <div class="btn-group">
                            <button type="button" id="addProduct" class="btn btn-primary" data-toggle="modal" data-target="#productModal">Add Product</button>
                        </div>
                        <div class="btn-group">    
                            <button type="button" id="addPartsKit" class="btn btn-primary" data-toggle="modal" data-target="#partsKitModal">Add Parts Kit</button>
                        </div>
                        <div class="btn-group">
                            <button type="button" id="addSinglePart" class="btn btn-primary" >Add Single Part</button>
                        </div>
                    !-->
                        <div class="btn-group">    
                            <button type="button" id="addPartsKit" class="btn btn-primary" data-toggle="modal" data-target="#partsKitModal">Quick Add</button>
                            <button type="button" id="addPartsKitAdvanced" onclick="location.href='/apex/dealer__DeskingAddEquipment?id={!deal.Id}';" class="btn btn-primary">Advanced Search</button>                            
                            <!--  Start of KVP -->
                            <apex:outputLabel style="padding: 10px 0 0 15px;" value="We-Owe Name ">
                                <apex:outputLink value="/{!weOwe.id}" id="eventlink" target="_blank" style="padding: 10px 0 0 15px;">{!weOwe.name}</apex:outputLink>
                            </apex:outputLabel>
                            <!--  End of KVP -->
                        </div>                    
                    </div>
                </div>  
                <div id="soldPartsKits" style="margin-left:150px;">
                    <table class="table table-hover" id="amTable">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Labor</th>
                                <th>Parts</th>
                                <th>Total</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="amTableBody">
                            
                        </tbody>
                    </table>
                </div>

                <div class="row"></div>
                <div class="modal fade" id="partsKitModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
<!--                                 <button type="button" class="close" data-dismisss="modal"> -->
<!--                                     <span aria-hidden="true">&times;</span> -->
<!--                                     <span class="sr-only">Close</span> -->
<!--                                 </button> -->
                                <h4 class="modal-title" id="myModalLabel">Add Aftermarket</h4>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-3">Description</div>
                                    <div class="col-md-2">Labor</div>
                                    <div class="col-md-2">Parts</div>
                                    <div class="col-md-2">Total</div>
                                </div>
                                <div class="row">
                                    <div class="col-md-3"><apex:inputText html-ff="Desking:frm:partsKit-Labor" id="partsKitLookup" styleClass="form-control" /></div>
                                    <div class="col-md-2"><apex:inputText html-ff="Desking:frm:partsKit-Parts" id="partsKit-Labor" styleClass="form-control" /></div>
                                    <div class="col-md-2"><apex:inputText html-ff="Desking:frm:partsKit-Total" id="partsKit-Parts" styleClass="form-control" /></div>
                                    <div class="col-md-2"><apex:inputText html-ff="sellPartsKit" id="partsKit-Total" styleClass="form-control" /></div>
                                    <apex:inputHidden id="partsKit-Id" />
                                    <c:AutoComplete objectname="dealer__Parts_Kit__c" 
                                            additionalfield="dealer__Description__c" 
                                            resultfields="dealer__Kit_Price__c,dealer__Labor_Cost__c,dealer__Kit_List__c,dealer__Labor_Sale__c,dealer__Sell_on_Deals__c" 
                                            autocomplete_textbox="{!$Component.partsKitLookup}" />
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="sellPartsKit" data-dismiss="modal" >Sell</button>                                
                            </div>
                        </div>
                    </div>  
                </div>
                <!-- Modal Template
                <div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                              <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                              </div>
                             <div class="modal-body">
                                ...
                              </div>
                              <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary">Save changes</button>
                              </div> 
                        </div>
                    </div>
                </div> 
                -->  
            </div> <!-- End of Aftermarket Screen -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  FEES SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->  
            <div class="tab-pane" id="fees">
                <div class="row">
                    <div class="col-sm-4">
                        <label for="licensefee" class="col-sm-3 control-label">License</label>
                        <div class="col-sm-7">
                            <input type="text" ff="misclicensefee" class="form-control" id="licensefee" value="" sfid="" onBlur="saveFee('License', 'licensefee')" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="smogabate" class="col-sm-3 control-label">Smog Abate</label>
                        <div class="col-sm-7">
                            <input type="text" ff="smogfee" class="form-control" id="smogabate" sfid="" value="" onBlur="saveFee('Smog Abatement', 'smogabate')" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="misclicensefee" class="col-sm-3 control-label">Misc. License</label>
                        <div class="col-sm-7">
                            <input type="text" ff="cancelfee" class="form-control" id="misclicensefee" sfid="" value="" onBlur="saveFee('Misc. License', 'misclicensefee')" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="smogfee" class="col-sm-3 control-label">Smog Fee</label>
                        <div class="col-sm-7">
                            <input type="text" ff="smogcert" class="form-control" id="smogfee" sfid="" value="" onBlur="saveFee('Smog Fee', 'smogfee')" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4 col-sm-offset-4">
                        <label for="smogcert" class="col-sm-3 control-label">Smog Cert</label>
                        <div class="col-sm-7">
                            <input type="text" ff="statetax" class="form-control" id="smogcert" sfid="" value="" onBlur="saveFee('Smog Certificate', 'smogcert')" />
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="cancelfee" class="col-sm-3 control-label">Cancel Fee</label>
                        <div class="col-sm-7">
                            <input type="text" ff="restockfee" class="form-control" id="cancelfee" sfid="" value="" onBlur="saveFee('Cancellation', 'cancelfee')" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="restockfee" class="col-sm-3 control-label">Restock Fee</label>
                        <div class="col-sm-7">
                            <input type="text" ff="excise" class="form-control" id="restockfee" sfid="" value="" onBlur="saveFee('Restocking', 'restockfee')" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="statetax" class="col-sm-3 control-label">State Tax Rate</label>
                        <div class="col-sm-7">
                            <input type="text" ff="countytax" class="form-control" id="statetax" sfid="" value=""/>
                        </div> 
                    </div>
                    <div class="col-sm-4">
                    
                        <label for="delivyerorpickup" class="col-sm-3 control-label"><apex:outputText value="{!$ObjectType.dealer__Deal__c.fields.dealer__Pickup_or_Delivery__c.Label}" /></label>
                        <div class="col-sm-7">
                            <apex:inputField value="{!dealer__Deal__c.dealer__Pickup_or_Delivery__c}" styleClass="form-control" />
                        </div> 
                    
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4 col-sm-offset-4">
                        <label for="countytax" class="col-sm-3 control-label">County Tax Rate</label>
                        <div class="col-sm-7">
                            <input type="text" ff="citytax" class="form-control" id="countytax" sfid="" value="" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="deliverto" class="col-sm-3 control-label">County</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="deliverto" />
                        </div> 
                    </div>                    
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="excise" class="col-sm-3 control-label">Excise Rate/Amt</label>
                        <div class="col-sm-7">
                            <input type="text" ff="elecfee" class="form-control" id="excise" sfid="" value="" onBlur="saveFee('Excise', 'excise')" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="citytax" class="col-sm-3 control-label">City Tax Rate</label>
                        <div class="col-sm-7">
                            <input type="text" class="form-control" id="citytax" sfid="" value="" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <!-- -->
                    </div>                    
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="elec" class="col-sm-3 control-label">Elec Filing</label>
                        <div class="col-sm-7">
                            <input type="text" ff="tirefee" class="form-control" id="elecfee" sfid="" value="" onBlur="saveFee('Electronic Filing', 'elecfee')" />
                        </div> 
                    </div>

                    <div class="col-sm-4">

                    </div>

                    <div class="col-sm-4">
                        <!-- -->                        
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="tire" class="col-sm-3 control-label">Tire Fee</label>
                        <div class="col-sm-7">
                            <input type="text" ff="smogabate" class="form-control" id="tirefee" sfid="" value="" onBlur="saveFee('Tire Fee', 'tirefee')" />
                        </div> 
                    </div>
                </div>
            </div> <!-- End of Fees Screen -->   

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  INSURANCE SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->   
            <div class="tab-pane" id="insurance">
                <div class="row">
                    <div class="col-sm-8">
                        <div class="col-sm-7 colhead">Auto Insurance Information</div> 
                    </div>
                    <div class="col-sm-4">
                        <div class="col-sm-7 colhead">GAP Information</div> 
                    </div>
                </div>
                <hr class="hairline" />
                <div class="row">
                    <div class="col-sm-4">
                        <label for="insurancecompany" class="col-sm-3 control-label">Company</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:agent" styleClass="form-control" id="insurancecompany" value="{!dealer__Deal__c.dealer__Auto_Insurance_Company__c}" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="insuranceaddress" class="col-sm-3 control-label">Address</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:insurancecity" styleClass="form-control" id="insuranceaddress" value="{!dealer__Deal__c.dealer__Auto_Insurance_Address__c}" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="gapcompany" class="col-sm-3 control-label">Company</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:gapterm" styleClass="form-control" id="gapcompany" value="{!dealer__Deal__c.dealer__GAP_Company__c}" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="agent" class="col-sm-3 control-label">Agent</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:insurancepolicy" styleClass="form-control" id="agent" value="{!dealer__Deal__c.dealer__Auto_Insurance_Agent__c}" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="insurancecity" class="col-sm-3 control-label">City</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:insurancestate" styleClass="form-control" id="insurancecity" value="{!dealer__Deal__c.dealer__Auto_Insurance_City__c}" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="gapterm" class="col-sm-3 control-label">Term</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:gappremium" styleClass="form-control" id="gapterm" value="{!dealer__Deal__c.dealer__GAP_Term__c}" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
 
                    </div>
                    <div class="col-sm-4">
                        <label for="insurancestate" class="col-sm-3 control-label">State</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:insurancezip" styleClass="form-control" id="insurancestate" value="{!dealer__Deal__c.dealer__Auto_Insurance_State__c}" />
                        </div>   
                    </div>
                    <div class="col-sm-4">
                        <label for="gappremium" class="col-sm-3 control-label">Premium</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" styleClass="form-control" id="gappremium" value="{!dealer__Deal__c.dealer__GAP_Premium__c}" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="insurancepolicy" class="col-sm-3 control-label">Policy #</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:effdate" styleClass="form-control" id="insurancepolicy" value="{!dealer__Deal__c.dealer__Auto_Insurance_Policy__c}" />
                        </div> 
                    </div>
                    <div class="col-sm-4">
                        <label for="insurancezip" class="col-sm-3 control-label">Zip</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:insurancephone" styleClass="form-control" id="insurancezip" value="{!dealer__Deal__c.dealer__Auto_Insurance_Zip__c}" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="insuranceterm" class="col-sm-3 control-label">&nbsp;</label>
                        <div class="col-sm-7">
                            
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
 
                    </div>
                    <div class="col-sm-4">
                        <label for="insurancephone" class="col-sm-3 control-label">Agent Phone</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:insurancecontact" styleClass="form-control" id="insurancephone" value="{!dealer__Deal__c.dealer__Auto_Insurance_Phone__c}" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="effdate" class="col-sm-3 control-label">EFF Date</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:effdate" styleClass="form-control" id="effdate" value="{!dealer__Deal__c.dealer__Auto_Insurance_Effective_Date__c}" />
                        </div> 
                    </div>                    
                    <div class="col-sm-4">
                        <label for="insurancecontact" class="col-sm-3 control-label">Contact</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" styleClass="form-control" id="insurancecontact" value="{!dealer__Deal__c.dealer__Auto_Insurance_Contact__c}" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="expdate" class="col-sm-3 control-label">Exp Date</label>
                        <div class="col-sm-7">
                            <apex:inputField type="text" html-ff="Desking:frm:insuranceaddress" styleClass="form-control" id="expdate" value="{!dealer__Deal__c.dealer__Auto_Insurance_Expiration_Date__c}" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="comded" class="col-sm-3 control-label">COM Deductible</label>
                        <div class="col-sm-7">
                            <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Auto_Insurance_COM_Deducatable__c}" />
                        </div> 
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label for="colded" class="col-sm-3 control-label">COL Deductible</label>
                        <div class="col-sm-7">
                            <apex:inputField styleClass="form-control" value="{!dealer__Deal__c.dealer__Auto_Insurance_COL_Deductable__c}" />
                        </div> 
                    </div>
                </div>
            </div> <!-- End of Insurance Screen -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  FORMS SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->  
            <div class="tab-pane" id="forms">

                <div class="row" style="width:85%;margin-left:45px;">
                    <div class="col-sm-10">
                    <apex:pageBlock mode="maindetail" id="formBlock">
                        <!--<apex:pageBlockTable value="{!forms}" var="f" id="formTable">
                                <apex:column value="{!f.Name}" />
                                <apex:column value="{!f.Form_ID__c}" />
                                <apex:column value="{!f.Revision_Date__c}" />
                                <apex:column value="{!f.Print_Type__c}" />
                                <apex:column >
                                    <apex:outputText rendered="{!IF(f.Print_Type__c=='Laser', true, false)}">
                                        <button type="button" id="laserForm" onclick="window.open('{!baseURLNonManaged}/apex/{!f.Page_Name__c}?id={!Deal__c.Id}')" class="btn btn-default btn-sm">Print Laser Form</button> <!--{!baseURLNonManaged}/apex/{!f.Page_Name__c}?id={!Deal__c.Id}-->
                                    <!--</apex:outputText>

                                    <apex:outputText rendered="{!IF(f.Print_Type__c=='Impact', true, false)}">
                                        <button type="button" id="prntImpact" onclick="compileForm('{!f.Id}')" class="btn btn-default btn-sm">Print Impact Form</button>
                                    </apex:outputText>
                                </apex:column>
                        </apex:pageBlockTable>-->
                        <apex:pageBlockTable value="{!listFormWrap}" var="f" id="formTable">
                                <apex:column value="{!f.objForm.Name}" />
                                <apex:column value="{!f.objForm.dealer__Form_ID__c}" />
                                <apex:column value="{!f.objForm.dealer__Revision_Date__c}" />
                                <apex:column value="{!f.objForm.dealer__Print_Type__c}" />
                                <apex:column >
                                    <apex:outputText rendered="{!IF(f.objForm.dealer__Print_Type__c=='Laser', true, false)}">
                                        <button type="button" id="laserForm" onclick="window.open('{!baseURLNonManaged}/apex/{!f.objForm.Page_Name__c}?id={!Deal__c.Id}')" class="btn btn-default btn-sm">Print Laser Form</button> <!--{!baseURLNonManaged}/apex/{!f.Page_Name__c}?id={!Deal__c.Id}-->
                                    </apex:outputText>

                                    <apex:outputText rendered="{!IF(f.objForm.dealer__Print_Type__c=='Impact', true, false)}">
                                        <button type="button" id="prntImpact" onclick="compileForm('{!f.objForm.Id}')" class="btn btn-default btn-sm">Print Impact Form</button>
                                    </apex:outputText>

                                    <apex:outputText rendered="{!if(f.objForm.dealer__Print_Type__c=='FDF', true, false)}">
                                        <button type="button" id="printPDFButton" onclick="printPDF('{!f.objForm.Id}', '{!f.objForm.dealer__DocumentContentId__c}', '{!f.objForm.dealer__Flatten__c}', '{!f.objForm.Name}')"
                                            class="btn btn-default btn-sm">Print Laser Form</button>
                                    </apex:outputText>
                                </apex:column>
                                <apex:column headerValue="Select">
                                    <apex:inputCheckbox value="{!f.selected}" rendered="{!f.objForm.dealer__Print_Type__c=='Laser'}"/>
                                </apex:column>
                        </apex:pageBlockTable>
                    </apex:pageBlock>
                    <apex:pageBlock id="hiddenBlock" rendered="false"></apex:pageBlock>
                    </div>

                    <div class="col-sm-2">
                        <div id="printerAppletStatus"></div>
                        <div id="useImpactForms">Enable Impact Forms:&nbsp;<apex:inputCheckbox id="impactOnOff" value="{!config.dealer__Enable_Impact_Forms__c}" label="Enable Impact Forms" /></div>
                        <div id="printerName">
                            Impact Printer Name:&nbsp;<apex:inputField id="printerSelected" value="{!config.dealer__Impact_Printer_Name__c}" styleClass="form-control" />
                        </div>
                        <br/>
                        <div>
                            <apex:commandButton value="Print Laser Forms" action="{!mergeAndPrint}"/>
                        </div>
                    </div>
                </div>
            </div> <!-- End of Forms Tab -->

            <!--
            ////////////////////////////////////////////////////////////////////////
            //  DELIVERY FIELD SET SCREEN
            //////////////////////////////////////////////////////////////////////// 
            -->  
            <div class="tab-pane" id="delivery">
                <div class="row" style="width:85%;margin-left:45px;">
                    <apex:pageBlock mode="maindetail" id="deliveryBlock">
                        <apex:pageBlockSection title="Vehicle Delivery" collapsible="false">
                            <apex:repeat value="{!$ObjectType.dealer__Deal__c.FieldSets.dealer__VehicleDelivery}" var="field">
                                <apex:inputField styleClass="form-control" value="{!dealer__Deal__c[field]}" />
                            </apex:repeat>
                        </apex:pageBlockSection>
                        <apex:pageBlockSection title="Delivery Address" collapsible="false">
                          <apex:repeat value="{!$ObjectType.dealer__Deal__c.FieldSets.dealer__DeliveryAddress}" var="tf">
                              <apex:inputField styleClass="form-control" value="{!dealer__Deal__c[tf]}" />
                          </apex:repeat>
                        </apex:pageBlockSection>   
                        <apex:pageBlockSection title="Arrival / Pick Up Information" collapsible="false">
                          <apex:repeat value="{!$ObjectType.dealer__Deal__c.FieldSets.dealer__ArrivalPickupInformation}" var="tf">
                              <apex:inputField styleClass="form-control" value="{!dealer__Deal__c[tf]}" />
                          </apex:repeat>
                        </apex:pageBlockSection>                                             
                    </apex:pageBlock>
                </div>
            </div> <!-- End of Forms Tab -->            

            <!-- Chatter Tab -->
            <style type="text/css">
                .feedpage { width: auto !important; }
                .feedDropDown { display: none !important; }
                .publishercontainer .bottomBar {
                    height: 50px !important;
                }
                .cxcommentplaceholderaction { height: 35px !important; }
            </style>

            <!--
            // Chatter Screen
            -->
            <div class="tab-pane" id="chatter">
                <div id="cFeed">
                    <chatter:feedWithFollowers entityId="{!deal.Id}" id="chatterFeedWtihFollowers" showHeader="false" />
                </div> 
            </div>
        </div> 
    </div>
    </apex:form> 
    
 <!--START OF POPUP MODAL-->
  <!-- Modal -->
    <apex:outputPanel rendered="{!inventoryVehicleList.size>0}">
    <apex:form id="StockIn" styleClass="">
        
        <div class="modal fade" id="stockInModal" tabindex="-1" role="dialog">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close" onclick="displayInfo()"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel"> Add Vehicle to Inventory </h4>
                    </div>
                    <div class="modal-body">
                    <apex:repeat value="{!inventoryVehicleList}" var="vehicleInventory">
                        <div class="row">
                            <div class="col-md-4 form-group">   
                                <label for="purchaseAmt">Purchase Amount</label>
                                <div class="input-group">
                                    <span class="input-group-addon">$</span>
                                    <apex:inputField styleClass="form-control" id="purchaseAmt" value="{!vehicleInventory.dealer__Purchase_Price__c}" required="true" />
                                </div>                      
                            </div>

                            <div class="col-md-4 form-group">
                                <label for="stockNumber">Stock #</label>
                                <apex:inputField styleClass="form-control" id="stockNumber" value="{!vehicleInventory.dealer__Stock_Number__c}" required="true"/>
                            </div>
                        <!--
                            <div class="col-md-4 form-group">
                                <label for="invRef">Inv. Ref.</label>
                                <apex:inputField styleClass="form-control" id="invRef" value="{!vehicleInventory.Invoice_Reference__c}" required="true"/>
                            </div>
                        --> 
       
                            <div class="col-md-4 form-group">
                                <label for="invRef">VIN</label>
                                <apex:inputField styleClass="form-control" id="invVin" value="{!vehicleInventory.dealer__VIN__c}" required="true"/>
                            </div>
       
                            <div class="col-md-4 form-group">
                                <label for="invRef">Year</label>
                                <apex:inputField styleClass="form-control" id="invYear" value="{!vehicleInventory.dealer__Year__c}" required="true"/>
                            </div>
       
                            <div class="col-md-4 form-group">
                                <label for="invRef">Make</label>
                                <apex:inputField styleClass="form-control" id="invMake" value="{!vehicleInventory.dealer__Make__c}" required="true"/>
                            </div>
       
                            <div class="col-md-4 form-group">
                                <label for="invRef">Model</label>
                                <apex:inputField styleClass="form-control" id="invModel" value="{!vehicleInventory.dealer__Model__c}" required="true"/>
                            </div>
                        </div>
                        </apex:repeat>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal" onclick="displayInfo()">Close</button>
<!--                         <apex:outputPanel rendered="{!inventoryVehicleList.size>0}"> -->
                            <apex:commandButton id="stockInVehicle" value="Add to Inventory" onclick="saveInventory();" oncomplete="createInventory();" styleClass="btn btn-primary" />
                            <input type="text" id="focusMeOnCreate" style="display:none" />
<!--                        </apex:outputPanel> -->
                    </div>
                </div>
            </div>
        </div>
    </apex:form>
    </apex:outputPanel>
    <!-- Modal -->
 <!--END OF POPUP MODAL-->
    
</div> <!-- End BootStrap NS -->     
</apex:page>